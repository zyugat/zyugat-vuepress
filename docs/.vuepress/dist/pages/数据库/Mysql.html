<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Mysql | zyugat个人文档</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="zyugat个人文档">
    
    <link rel="preload" href="/assets/css/0.styles.c4d68e36.css" as="style"><link rel="preload" href="/assets/js/app.4a585ce4.js" as="script"><link rel="preload" href="/assets/js/6.265514d3.js" as="script"><link rel="preload" href="/assets/js/2.1f413f74.js" as="script"><link rel="preload" href="/assets/js/24.c801625b.js" as="script"><link rel="prefetch" href="/assets/js/10.95cb0286.js"><link rel="prefetch" href="/assets/js/11.f84ec096.js"><link rel="prefetch" href="/assets/js/12.397ff928.js"><link rel="prefetch" href="/assets/js/13.91be1ea0.js"><link rel="prefetch" href="/assets/js/14.9e8a3b2f.js"><link rel="prefetch" href="/assets/js/15.03ee4687.js"><link rel="prefetch" href="/assets/js/16.c3939a8f.js"><link rel="prefetch" href="/assets/js/17.4466f1a7.js"><link rel="prefetch" href="/assets/js/18.6c5bcdea.js"><link rel="prefetch" href="/assets/js/19.da954f1a.js"><link rel="prefetch" href="/assets/js/20.e033095e.js"><link rel="prefetch" href="/assets/js/21.eb36ae8f.js"><link rel="prefetch" href="/assets/js/22.30ea8f60.js"><link rel="prefetch" href="/assets/js/23.664bb651.js"><link rel="prefetch" href="/assets/js/25.55542070.js"><link rel="prefetch" href="/assets/js/26.ef497d4c.js"><link rel="prefetch" href="/assets/js/27.e5adba4f.js"><link rel="prefetch" href="/assets/js/3.bd2fd891.js"><link rel="prefetch" href="/assets/js/4.43a46bc1.js"><link rel="prefetch" href="/assets/js/5.8f8a693a.js"><link rel="prefetch" href="/assets/js/7.e3532dc9.js"><link rel="prefetch" href="/assets/js/8.fa39e0d9.js"><link rel="prefetch" href="/assets/js/9.737307f5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c4d68e36.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">zyugat个人文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/pages/contact/" class="nav-link">
  联系
</a></div><div class="nav-item"><a href="https://github.com/zyugat" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/pages/contact/" class="nav-link">
  联系
</a></div><div class="nav-item"><a href="https://github.com/zyugat" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Web</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>数据库</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/数据库/MongoDB.html" class="sidebar-link">MongoDB</a></li><li><a href="/pages/数据库/Mysql.html" class="active sidebar-link">Mysql</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/数据库/Mysql.html#数据库操作" class="sidebar-link">数据库操作</a></li><li class="sidebar-sub-header"><a href="/pages/数据库/Mysql.html#表操作" class="sidebar-link">表操作</a></li><li class="sidebar-sub-header"><a href="/pages/数据库/Mysql.html#数据类型补充" class="sidebar-link">数据类型补充</a></li><li class="sidebar-sub-header"><a href="/pages/数据库/Mysql.html#时间日期" class="sidebar-link">时间日期</a></li><li class="sidebar-sub-header"><a href="/pages/数据库/Mysql.html#排序与聚合" class="sidebar-link">排序与聚合</a></li><li class="sidebar-sub-header"><a href="/pages/数据库/Mysql.html#多表查询" class="sidebar-link">多表查询</a></li><li class="sidebar-sub-header"><a href="/pages/数据库/Mysql.html#事务处理" class="sidebar-link">事务处理</a></li><li class="sidebar-sub-header"><a href="/pages/数据库/Mysql.html#锁" class="sidebar-link">锁</a></li><li class="sidebar-sub-header"><a href="/pages/数据库/Mysql.html#外键约束" class="sidebar-link">外键约束</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>软件配置</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>乱</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mysql"><a href="#mysql" class="header-anchor">#</a> Mysql</h1> <p>连接数据库</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>mysql -uroot -p
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="数据库操作"><a href="#数据库操作" class="header-anchor">#</a> 数据库操作</h2> <p><strong>数据库列表</strong></p> <p>使用以下命令可以得到当前服务器中的所有数据库。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">show</span> <span class="token keyword">databases</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>创建新库</strong></p> <p>下面是创建数据库 <code>testmysql</code> 并设置字符集为 utf8。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">database</span> testmysql <span class="token keyword">CHARSET</span> utf8<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>查看数据库</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">show</span> <span class="token keyword">create</span> <span class="token keyword">database</span> testmysql<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>删除数据库</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">drop</span> <span class="token keyword">database</span> testmysql<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>为了防止删除不存在的数据库报错</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">drop</span> <span class="token keyword">database</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> testmysql<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>选择数据库</strong></p> <p>数据库主要是对表操作，选择数据库后可以省掉每次指定数据库的麻烦。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">use</span> testmysql
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="表操作"><a href="#表操作" class="header-anchor">#</a> 表操作</h2> <p>创建表</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> users<span class="token punctuation">(</span>
    uid <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span>
    uname <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    utext <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">null</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>添加数据</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> users<span class="token punctuation">(</span>uname<span class="token punctuation">,</span> utext<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'First'</span><span class="token punctuation">,</span> <span class="token string">'第一个'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>复制数据</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 创建一个`users2`的表，将`users`的数据复制其中</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> users2 <span class="token operator">like</span> users<span class="token punctuation">;</span>

<span class="token comment"># 复制其他表的数据</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> users2 <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users<span class="token punctuation">;</span>

<span class="token comment"># 只复制批定字段</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> users2 <span class="token punctuation">(</span>uname<span class="token punctuation">)</span> <span class="token keyword">select</span> uname <span class="token keyword">from</span> users<span class="token punctuation">;</span>

<span class="token comment"># 只复制指定字段，并为不同名字段起别名</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> users2 <span class="token punctuation">(</span>id <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">select</span> id<span class="token punctuation">,</span>cname <span class="token keyword">as</span> name <span class="token keyword">from</span> users<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>删除表</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">drop</span> <span class="token keyword">table</span> users<span class="token punctuation">;</span>
<span class="token keyword">drop</span> <span class="token keyword">temporary</span> <span class="token keyword">table</span> users<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>修改表</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 修改字段类型</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> users <span class="token keyword">modify</span> utext <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 修改字段名与字段类型</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> users change utext newtext <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 添加字段</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> users <span class="token keyword">add</span> uage <span class="token keyword">int</span><span class="token punctuation">;</span>

<span class="token comment"># 在id后面添加字段</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> users <span class="token keyword">add</span> uage <span class="token keyword">int</span> <span class="token keyword">after</span> uid<span class="token punctuation">;</span>

<span class="token comment"># 字段添加在最前</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> users <span class="token keyword">add</span> uage <span class="token keyword">int</span> <span class="token keyword">first</span><span class="token punctuation">;</span>

<span class="token comment"># 删除字段</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> users <span class="token keyword">drop</span> uage<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>临时表</p> <ul><li>可以与普通表同名，优先级高于普通表</li> <li>连接终端时自动删除</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">temporary</span> <span class="token keyword">TABLE</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p><strong>执行顺序</strong></p> <p>from       -- 查询</p> <p>where      -- 限制条件</p> <p>group by   -- 分组</p> <p>having     -- 过滤条件</p> <p>order by   -- 排序</p> <p>limit      -- 展示条数</p> <p>distinct   -- 去重</p> <p>select     -- 查询的结果</p> <p>正则：<code>select * from emp where name regexp '^j.*(n|y)$';</code></p> <p>集合查询：max 、min 、avg 、sum 、count 、group_concat 。</p> <p>内连接：inner join</p> <p>左连接：left join</p> <p>右连接：right join</p> <p>全连接： 左连接 union 右连接</p> <p>replace 替换</p></blockquote> <p>查询数据</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users<span class="token punctuation">;</span>

<span class="token comment"># 合并查询,将数据合并成一个</span>
<span class="token keyword">select</span> CONCAT<span class="token punctuation">(</span>uid<span class="token punctuation">,</span>uname<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'class_info'</span> <span class="token keyword">FROM</span> users<span class="token punctuation">;</span>

<span class="token comment"># 通过like语句查询，包含&quot;第一&quot;这一关键字的字段</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users <span class="token keyword">where</span> utext <span class="token operator">like</span> <span class="token string">'%第一%'</span><span class="token punctuation">;</span>

<span class="token comment"># 不包含&quot;第一&quot;这一关键字的字段</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users <span class="token keyword">where</span> utext <span class="token operator">not</span> <span class="token operator">like</span> <span class="token string">'%第一%'</span><span class="token punctuation">;</span>

<span class="token comment"># 去重复</span>
<span class="token keyword">select</span> <span class="token keyword">distinct</span> uname <span class="token keyword">from</span> users<span class="token punctuation">;</span>

<span class="token comment"># ID 20到35之间</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users <span class="token keyword">where</span> uid <span class="token operator">between</span> <span class="token number">20</span> <span class="token operator">and</span> <span class="token number">35</span><span class="token punctuation">;</span>

<span class="token comment"># 查询uid为1，2，3的字段</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> users <span class="token keyword">where</span> uid <span class="token operator">in</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>排序</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 从大到小</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> users <span class="token keyword">order</span> <span class="token keyword">by</span> uid <span class="token keyword">desc</span><span class="token punctuation">;</span>

<span class="token comment"># 随机找一个数据</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">from</span> users <span class="token keyword">order</span> <span class="token keyword">by</span> RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">limit</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>数据操作</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 更新数据</span>
<span class="token keyword">update</span> users <span class="token keyword">set</span> uid <span class="token operator">=</span> <span class="token number">3</span> <span class="token keyword">where</span> uname <span class="token operator">=</span> <span class="token string">'third'</span><span class="token punctuation">;</span>

<span class="token comment"># 删除数据</span>
<span class="token keyword">delete</span> <span class="token keyword">from</span> users <span class="token keyword">where</span> uid<span class="token operator">=</span><span class="token number">3</span>

<span class="token comment"># 添加数据</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> users<span class="token punctuation">(</span>uname<span class="token punctuation">,</span> utext<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'First'</span><span class="token punctuation">,</span> <span class="token string">'第一个'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="数据类型补充"><a href="#数据类型补充" class="header-anchor">#</a> 数据类型补充</h2> <p><strong>if</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> uname<span class="token punctuation">,</span><span class="token keyword">if</span><span class="token punctuation">(</span>sex<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> users<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>Left&amp;right&amp;mid</strong></p> <p>取左或右指定数量的字符</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># left(uname,2)=查询前两位</span>
<span class="token comment"># left(uname,2,3)查询第二和第三位</span>
<span class="token keyword">select</span> <span class="token keyword">left</span><span class="token punctuation">(</span>uname<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">left</span><span class="token punctuation">(</span>uname<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">from</span> users<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>substring</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 从第二个位置开始向右匹配</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users <span class="token keyword">where</span> substring<span class="token punctuation">(</span>uname<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">'econd'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>char_length</strong>：获取字符串数量</p> <p><strong>concat</strong>：连接字符串</p> <p><strong>正则表达式</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 查找第二个字符为e的字符串</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> users <span class="token keyword">WHERE</span> uname <span class="token operator">REGEXP</span> <span class="token string">'^.e'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>like</strong></p> <p>匹配任意字符：<code>%</code></p> <p>匹配一个字符：<code>_</code></p> <p>匹配关键字：<code>%关键字%</code></p> <p><strong>整型</strong></p> <table><thead><tr><th>MySQL数据类型</th> <th>范围（有符号）</th> <th>范围（无符号）</th></tr></thead> <tbody><tr><td>tinyint(m)</td> <td>1个字节 范围(-128~127)</td> <td>(0，255)</td></tr> <tr><td>smallint(m)</td> <td>2个字节 范围(-32768~32767)</td> <td>(0，65 535)</td></tr> <tr><td>mediumint(m)</td> <td>3个字节 范围(-8388608~8388607)</td> <td>(0，16 777 215)</td></tr> <tr><td>int(m)</td> <td>4个字节 范围(-2147483648~2147483647)</td> <td>(0，4 294 967 295)</td></tr> <tr><td>bigint(m)</td> <td>8个字节 范围(+-9.22*10的18次方)</td> <td>(0，18 446 744 073 709 551 615)</td></tr></tbody></table> <p>m代表<strong>显示长度</strong>，如果加上<code>zerofill</code>则表示<strong>允许字段的长度</strong>，如果不满5位则在前面填0</p> <p><strong>浮点型</strong></p> <table><thead><tr><th style="text-align:left;">类型</th> <th style="text-align:left;">大小</th> <th style="text-align:left;">范围（有符号）</th> <th style="text-align:left;">范围（无符号）</th></tr></thead> <tbody><tr><td style="text-align:left;">FLOAT</td> <td style="text-align:left;">4 字节</td> <td style="text-align:left;">(-3.402 823 466 E+38，-1.175 494 351 E-38)，0，(1.175 494 351 E-38，3.402 823 466 351 E+38)</td> <td style="text-align:left;">0，(1.175 494 351 E-38，3.402 823 466 E+38)</td></tr> <tr><td style="text-align:left;">DOUBLE</td> <td style="text-align:left;">8 字节</td> <td style="text-align:left;">(-1.797 693 134 862 315 7 E+308，-2.225 073 858 507 201 4 E-308)，0，(2.225 073 858 507 201 4 E-308，1.797 693 134 862 315 7 E+308)</td> <td style="text-align:left;">0，(2.225 073 858 507 201 4 E-308，1.797 693 134 862 315 7 E+308)</td></tr> <tr><td style="text-align:left;">DECIMAL</td> <td style="text-align:left;">DECIMAL(M,D) ，m&lt;65 是总个数，d&lt;30</td> <td style="text-align:left;">依赖于M和D的值</td> <td style="text-align:left;">依赖于M和D的值</td></tr></tbody></table> <p><strong>ENUM</strong></p> <p>类似单选，只允许在集合种取一个指</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> users <span class="token keyword">ADD</span> sex <span class="token keyword">ENUM</span><span class="token punctuation">(</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> users <span class="token punctuation">(</span>uname<span class="token punctuation">,</span>sex<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'用户1'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment"># 男</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">from</span> users <span class="token keyword">WHERE</span> sex<span class="token operator">=</span><span class="token string">'女'</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">from</span> users <span class="token keyword">WHERE</span> sex<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>SET</strong></p> <p>多选，集合</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> users <span class="token keyword">ADD</span> flag <span class="token keyword">SET</span><span class="token punctuation">(</span><span class="token string">'推荐'</span><span class="token punctuation">,</span><span class="token string">'置顶'</span><span class="token punctuation">,</span><span class="token string">'图文'</span><span class="token punctuation">,</span><span class="token string">'热门'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> users <span class="token punctuation">(</span>uname<span class="token punctuation">,</span>flag<span class="token punctuation">)</span><span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'用户'</span><span class="token punctuation">,</span><span class="token string">'图文,推荐,置顶'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="时间日期"><a href="#时间日期" class="header-anchor">#</a> 时间日期</h2> <p><strong>数据类型</strong></p> <table><thead><tr><th>日期时间类型</th> <th>占用空间</th> <th>日期格式</th> <th>最小值</th> <th>最大值</th> <th>零值表示</th></tr></thead> <tbody><tr><td>DATETIME</td> <td>8 bytes</td> <td>YYYY-MM-DD HH:MM:SS</td> <td>1000-01-01 00:00:00</td> <td>9999-12-31 23:59:59</td> <td>0000-00-00 00:00:00</td></tr> <tr><td>TIMESTAMP</td> <td>4 bytes</td> <td>YYYY-MM-DD HH:MM:SS</td> <td>1970-01-01 08:00:01</td> <td>2038-01-19 03:14:07</td> <td>00000000000000</td></tr> <tr><td>DATE</td> <td>4 bytes</td> <td>YYYY-MM-DD</td> <td>1000-01-01</td> <td>9999-12-31</td> <td>0000-00-00</td></tr> <tr><td>TIME</td> <td>3 bytes</td> <td>HH:MM:SS</td> <td>-838:59:59</td> <td>838:59:59</td> <td>00:00:00</td></tr> <tr><td>YEAR</td> <td>1 bytes</td> <td>YYYY</td> <td>1901</td> <td>2155</td> <td>0000</td></tr></tbody></table> <ul><li>Mysql保存日期格式使用 YYYY-MM-DD HH:MM:SS的ISO 8601标准</li> <li>向数据表储存日期与时间必须使用ISO格式</li></ul> <p>创建字段</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">alter</span> <span class="token keyword">table</span> users <span class="token keyword">add</span> birthday <span class="token keyword">datetime</span> <span class="token keyword">default</span> <span class="token boolean">null</span><span class="token punctuation">;</span>
<span class="token keyword">update</span> users <span class="token keyword">set</span> birthday <span class="token operator">=</span> <span class="token string">&quot;2000-1-1 12:12:12&quot;</span> <span class="token keyword">where</span> uid<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>参数介绍</strong></p> <table><thead><tr><th style="text-align:left;">格式</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">%a</td> <td style="text-align:left;">缩写星期名</td></tr> <tr><td style="text-align:left;">%b</td> <td style="text-align:left;">缩写月名</td></tr> <tr><td style="text-align:left;">%c</td> <td style="text-align:left;">月，数值</td></tr> <tr><td style="text-align:left;">%D</td> <td style="text-align:left;">带有英文前缀的月中的天</td></tr> <tr><td style="text-align:left;">%d</td> <td style="text-align:left;">月的天，数值(00-31)</td></tr> <tr><td style="text-align:left;">%e</td> <td style="text-align:left;">月的天，数值(0-31)</td></tr> <tr><td style="text-align:left;">%f</td> <td style="text-align:left;">微秒</td></tr> <tr><td style="text-align:left;">%H</td> <td style="text-align:left;">小时 (00-23)</td></tr> <tr><td style="text-align:left;">%h</td> <td style="text-align:left;">小时 (01-12)</td></tr> <tr><td style="text-align:left;">%I</td> <td style="text-align:left;">小时 (01-12)</td></tr> <tr><td style="text-align:left;">%i</td> <td style="text-align:left;">分钟，数值(00-59)</td></tr> <tr><td style="text-align:left;">%j</td> <td style="text-align:left;">年的天 (001-366)</td></tr> <tr><td style="text-align:left;">%k</td> <td style="text-align:left;">小时 (0-23)</td></tr> <tr><td style="text-align:left;">%l</td> <td style="text-align:left;">小时 (1-12)</td></tr> <tr><td style="text-align:left;">%M</td> <td style="text-align:left;">月名</td></tr> <tr><td style="text-align:left;">%m</td> <td style="text-align:left;">月，数值(00-12)</td></tr> <tr><td style="text-align:left;">%p</td> <td style="text-align:left;">AM 或 PM</td></tr> <tr><td style="text-align:left;">%r</td> <td style="text-align:left;">时间，12-小时（hh:mm:ss AM 或 PM）</td></tr> <tr><td style="text-align:left;">%S</td> <td style="text-align:left;">秒(00-59)</td></tr> <tr><td style="text-align:left;">%s</td> <td style="text-align:left;">秒(00-59)</td></tr> <tr><td style="text-align:left;">%T</td> <td style="text-align:left;">时间, 24-小时 (hh:mm:ss)</td></tr> <tr><td style="text-align:left;">%U</td> <td style="text-align:left;">周 (00-53) 星期日是一周的第一天</td></tr> <tr><td style="text-align:left;">%u</td> <td style="text-align:left;">周 (00-53) 星期一是一周的第一天</td></tr> <tr><td style="text-align:left;">%V</td> <td style="text-align:left;">周 (01-53) 星期日是一周的第一天，与 %X 使用</td></tr> <tr><td style="text-align:left;">%v</td> <td style="text-align:left;">周 (01-53) 星期一是一周的第一天，与 %x 使用</td></tr> <tr><td style="text-align:left;">%W</td> <td style="text-align:left;">星期名</td></tr> <tr><td style="text-align:left;">%w</td> <td style="text-align:left;">周的天 （0=星期日, 6=星期六）</td></tr> <tr><td style="text-align:left;">%X</td> <td style="text-align:left;">年，其中的星期日是周的第一天，4 位，与 %V 使用</td></tr> <tr><td style="text-align:left;">%x</td> <td style="text-align:left;">年，其中的星期一是周的第一天，4 位，与 %v 使用</td></tr> <tr><td style="text-align:left;">%Y</td> <td style="text-align:left;">年，4 位</td></tr> <tr><td style="text-align:left;">%y</td> <td style="text-align:left;">年，2 位</td></tr></tbody></table> <p>使用<code>Date_format</code>格式化日期与时间显示</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> uname<span class="token punctuation">,</span> DATE_FORMAT<span class="token punctuation">(</span>birthday<span class="token punctuation">,</span> <span class="token string">'%Y年%m月%d日'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> users
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>使用<code>time_format</code>格式化输出时间，PM不含年月日，只有时间</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> uname<span class="token punctuation">,</span>TIME_FORMAT<span class="token punctuation">(</span>birthday<span class="token punctuation">,</span><span class="token string">'%r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> birthday <span class="token keyword">from</span> users<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>时间戳</strong></p> <p>以时间戳格式来记录日期与时间，当数据行发生变化，则时间戳会更新</p> <p>当前时间：<code>current_timestamp</code></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">alter</span> <span class="token keyword">table</span> users <span class="token keyword">add</span> updated_at
<span class="token keyword">timestamp</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token keyword">current_timestamp</span>
<span class="token keyword">on</span> <span class="token keyword">update</span> <span class="token keyword">current_timestamp</span>

<span class="token comment"># 当更新数据的时候会发生变化</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> users <span class="token keyword">set</span> uname <span class="token operator">=</span> <span class="token string">'小张'</span><span class="token punctuation">;</span>
<span class="token keyword">update</span> users <span class="token keyword">set</span> uname <span class="token operator">=</span> <span class="token string">'ih'</span> <span class="token keyword">where</span> uid <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>时间处理函数</p> <table><thead><tr><th>函数</th> <th>说明</th></tr></thead> <tbody><tr><td>HOUR</td> <td>时（范围从0到23）</td></tr> <tr><td>MINUTE</td> <td>分（范围从0到59）</td></tr> <tr><td>SECOND</td> <td>秒（范围从0到59）</td></tr> <tr><td>YEAR</td> <td>年（范围从1000 到 9999）</td></tr> <tr><td>MONTH</td> <td>月（范围从1到12）</td></tr> <tr><td>DAY</td> <td>日（范围从1开始）</td></tr> <tr><td>TIME</td> <td>获取时间</td></tr> <tr><td>WEEK</td> <td>一年中的第几周，从1开始计数</td></tr> <tr><td>QUARTER</td> <td>一年中的季度，从1开始计数</td></tr> <tr><td>CURRENT_DATE</td> <td>当前日期</td></tr> <tr><td>CURRENT_TIME</td> <td>当前时间</td></tr> <tr><td>NOW</td> <td>当前时间</td></tr> <tr><td>DAYOFYEAR</td> <td>一年中的第几天（从1开始）</td></tr> <tr><td>DAYOFMONTH</td> <td>月份中天数（从1开始）</td></tr> <tr><td>DAYOFWEEK</td> <td>星期天（1）到星期六（7）</td></tr> <tr><td>WEEKDAY</td> <td>星期一（0）到星期天（6）</td></tr> <tr><td>TO_DAYS</td> <td>从元年到现在的天数（忽略时间部分）</td></tr> <tr><td>FROM_DAYS</td> <td>根据天数得到日期（忽略时间部分）</td></tr> <tr><td>TIME_TO_SEC</td> <td>时间转为秒数（忽略日期部分）</td></tr> <tr><td>SEC_TO_TIME</td> <td>根据秒数转为时间（忽略日期部分）</td></tr> <tr><td>UNIX_TIMESTAMP</td> <td>根据日期返回秒数（包括日期与时间）</td></tr> <tr><td>FROM_UNIXTIME</td> <td>根据秒数返回日期与时间（包括日期与时间）</td></tr> <tr><td>DATEDIFF</td> <td>两个日期相差的天数（忽略时间部分，前面日期减后面日期）</td></tr> <tr><td>TIMEDIFF</td> <td>计算两个时间的间隔（忽略日期部分）</td></tr> <tr><td>TIMESTAMPDIFF</td> <td>根据指定单位计算两个日期时间的间隔（包括日期与时间）</td></tr> <tr><td>LAST_DAY</td> <td>该月的最后一天</td></tr></tbody></table> <p><strong>常用函数</strong></p> <p>获取当前时间</p> <p>日期：<code>NOW()</code></p> <p>年月日：<code>CURRENT_DATE()</code></p> <p>时间：<code>CURRENT_TIME()</code></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token keyword">CURRENT_DATE</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">CURRENT_TIME</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">set</span> <span class="token variable">@time</span> <span class="token operator">=</span> <span class="token keyword">time</span><span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment"># 获取当前时间，不含年月日</span>
<span class="token keyword">select</span> <span class="token variable">@time</span><span class="token punctuation">;</span>
<span class="token comment"># 时间转换成秒</span>
<span class="token keyword">select</span> TIME_TO_SEC<span class="token punctuation">(</span><span class="token variable">@time</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 计算两个时间相差的天数</span>
<span class="token keyword">select</span> datediff<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> birthday<span class="token punctuation">)</span> <span class="token keyword">from</span> users<span class="token punctuation">;</span>

<span class="token comment"># 计算两个时间相差，单位可以自定义：second、minute、day、week、month</span>
<span class="token keyword">select</span> timestampdiff<span class="token punctuation">(</span><span class="token keyword">day</span><span class="token punctuation">,</span> birthday<span class="token punctuation">,</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">from</span> users
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>时间计算</strong></p> <table><thead><tr><th>函数</th> <th>说明</th></tr></thead> <tbody><tr><td>ADDTIME</td> <td>添加时间（负数为减少），只对时间有效</td></tr> <tr><td>TIMESTAMP</td> <td>添加时间（负数为减少），只对时间有效</td></tr> <tr><td>DATE_ADD</td> <td>根据单位添加时间，支持单位有YEAR/MONTH/DAY/HOUR/MINUTE/SECOND/HOUR_MINUTE/DAY_HOUR/DAY_MINUTE/DAY_SECOND/HOUR_MINUTE/HOUR_SECOND（负数时等于DATE_SUB)</td></tr> <tr><td>DATE_SUB</td> <td>DATE_ADD的反函数</td></tr> <tr><td>LAST_DAY</td> <td>指定月最后一天日期</td></tr></tbody></table> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 添加时间</span>
<span class="token keyword">select</span> addtime<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'1:0:0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 7天后</span>
<span class="token keyword">select</span> date_add<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">interval</span> <span class="token number">7</span> <span class="token keyword">day</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment"># 7天前</span>
<span class="token keyword">select</span> date_add<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">interval</span> <span class="token operator">-</span><span class="token number">7</span> <span class="token keyword">day</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment"># 3天10小时后</span>
<span class="token keyword">select</span> date_add<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">interval</span> <span class="token string">&quot;3 10&quot;</span> day_hour <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 获取月尾</span>
<span class="token keyword">select</span> last_day<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment"># 获取月初，dayofmonth获取今天是这个月的第几天，然后减去自己的天数。</span>
<span class="token keyword">select</span> date_sub<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">interval</span> dayofmonth<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">day</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="排序与聚合"><a href="#排序与聚合" class="header-anchor">#</a> 排序与聚合</h2> <p><strong>order</strong></p> <ul><li>desc降序 asc升序</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 随机获取</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> users <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">LIMIT</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>自定义排序：<code>field</code></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> users <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> FIELD<span class="token punctuation">(</span><span class="token keyword">left</span><span class="token punctuation">(</span>uname<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'S'</span><span class="token punctuation">,</span><span class="token string">'F'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>统计：<code>count</code></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> users<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>最大最小：<code>min/max</code></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">max</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span> <span class="token keyword">FROM</span> users<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>总合平均：<code>sum/avg</code></p> <p>去重：<code>distinct</code></p> <p><strong>group</strong></p> <p>分组，将相同的分为同一个组</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span><span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span>uname<span class="token punctuation">)</span> <span class="token keyword">from</span> users <span class="token keyword">group</span> <span class="token keyword">by</span> uname
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>having</strong></p> <p>筛选，对group进行筛选，因此一定在后面</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 查找超过两个同学的班级</span>
<span class="token keyword">SELECT</span> class_id <span class="token keyword">FROM</span> stu <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> class_id <span class="token keyword">HAVING</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">2</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="多表查询"><a href="#多表查询" class="header-anchor">#</a> 多表查询</h2> <p><strong>笛卡尔积</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> stu <span class="token punctuation">,</span>class <span class="token keyword">WHERE</span> stu<span class="token punctuation">.</span>class_id <span class="token operator">=</span> class<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> stu <span class="token keyword">as</span> s<span class="token punctuation">,</span> class <span class="token keyword">as</span> c <span class="token keyword">WHERE</span> s<span class="token punctuation">.</span>class_id <span class="token operator">=</span> c<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>INNER JOIN</strong></p> <p>语义更加清晰</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> stu <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> class
<span class="token keyword">ON</span> stu<span class="token punctuation">.</span>class_id <span class="token operator">=</span> class<span class="token punctuation">.</span>id
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>OUTER JOIN</strong></p> <p>外链接包括<code>LEFT JOIN</code> 与 <code>RIGHT JOIN</code> ，可以简单理解为 <code>LEFT JOIN</code>会包含左侧所有表记录，<code>RIGHT JOIN</code> 会包含右侧表全部记录。</p> <p>以左侧的表（stu）为基准不做删改，将右侧的表（user_info）数据添加其中。</p> <p>意思是就算<code>id</code>与<code>stu_id</code>有不对应的数据，先显示<code>id</code>的数据。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> s<span class="token punctuation">.</span>sname <span class="token keyword">FROM</span> stu <span class="token keyword">AS</span> s <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> user_info <span class="token keyword">as</span> i
<span class="token keyword">ON</span> s<span class="token punctuation">.</span>id <span class="token operator">=</span> i<span class="token punctuation">.</span>stu_id
<span class="token keyword">WHERE</span> i<span class="token punctuation">.</span>qq <span class="token operator">is</span> <span class="token boolean">null</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>SELF JOIN</strong></p> <p>自连接即表与自身进行关联。虽然自连接的两张表都是同一张表，但也把它按两张表对待，这样理解就会容易些。</p> <p><strong>UNION</strong></p> <p>用于连接多个查询结果，要保证每个查询返回的列的数量与顺序要一样。</p> <ul><li>UNION会过滤重复的结果</li> <li>UNION ALL 不过滤重复结果</li> <li>列表字段由是第一个查询的字段</li></ul> <p><strong>查询年龄最大与最小的同学</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token punctuation">(</span><span class="token keyword">SELECT</span> sname<span class="token punctuation">,</span>birthday <span class="token keyword">FROM</span> stu <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> birthday <span class="token keyword">DESC</span> <span class="token keyword">LIMIT</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">UNION</span>
<span class="token punctuation">(</span><span class="token keyword">SELECT</span> sname<span class="token punctuation">,</span>birthday <span class="token keyword">from</span> stu <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> birthday <span class="token keyword">ASC</span> <span class="token keyword">LIMIT</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> birthday <span class="token keyword">DESC</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>多表删除</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">DELETE</span> s <span class="token keyword">FROM</span> stu <span class="token keyword">as</span> s 
<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> user_lesson <span class="token keyword">as</span> ul
<span class="token keyword">ON</span> s<span class="token punctuation">.</span>id <span class="token operator">=</span> ul<span class="token punctuation">.</span>stu_id
<span class="token keyword">WHERE</span> ul<span class="token punctuation">.</span>lesson_id <span class="token operator">IS</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> stu <span class="token keyword">WHERE</span> id <span class="token operator">IN</span><span class="token punctuation">(</span>
  <span class="token keyword">SELECT</span> id <span class="token keyword">FROM</span>
    <span class="token punctuation">(</span><span class="token keyword">SELECT</span> s<span class="token punctuation">.</span>id <span class="token keyword">FROM</span> stu <span class="token keyword">as</span> s
    <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> user_lesson <span class="token keyword">as</span> ul
    <span class="token keyword">ON</span> s<span class="token punctuation">.</span>id <span class="token operator">=</span> ul<span class="token punctuation">.</span>stu_id
    <span class="token keyword">WHERE</span> ul<span class="token punctuation">.</span>lesson_id <span class="token operator">IS</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span> 
  <span class="token keyword">AS</span> s
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="事务处理"><a href="#事务处理" class="header-anchor">#</a> 事务处理</h2> <p><strong>事务单独开启</strong></p> <ul><li><code>BEGIN</code>或<code>START TRANSACTION</code>：开始事务</li> <li><code>COMMIT</code>：提交事务</li> <li><code>ROLLBACK</code>：回滚事务</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">begin</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> users<span class="token punctuation">(</span>uname<span class="token punctuation">,</span> utext<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'xxx'</span><span class="token punctuation">,</span> <span class="token string">'1231x'</span><span class="token punctuation">)</span>
<span class="token keyword">commit</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>全局事务</strong></p> <p><code>SET AUTOCOMMIT=0</code> 关闭自动提交来开启事务机制</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 关闭自动提交</span>
<span class="token keyword">SET</span> AUTOCOMMIT <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> users<span class="token punctuation">(</span>uname<span class="token punctuation">,</span> utext<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'xxx'</span><span class="token punctuation">,</span> <span class="token string">'1231x'</span><span class="token punctuation">)</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>

<span class="token comment">-- 开启自动提交</span>
<span class="token keyword">SET</span> AUTOCOMMIT <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>隔离级别</strong></p> <table><thead><tr><th>事务隔离级别</th> <th>脏读</th> <th>不可重复读</th> <th>幻读</th> <th>说明</th></tr></thead> <tbody><tr><td>读未提交（read-uncommitted）</td> <td>是</td> <td>是</td> <td>是</td> <td>最低的事务隔离级别，一个事务还没提交时，它做的变更就能被别的事务看到</td></tr> <tr><td>不可重复读（read-committed）</td> <td>否</td> <td>是</td> <td>是</td> <td>保证一个事物提交后才能被另外一个事务读取。另外一个事务不能读取该事物未提交的数据。</td></tr> <tr><td>可重复读（repeatable-read）</td> <td>否</td> <td>否</td> <td>是</td> <td>多次读取同一范围的数据会返回第一次查询的快照，即使其他事务对该数据做了更新修改。事务在执行期间看到的数据前后必须是一致的。</td></tr> <tr><td>串行化（serializable）</td> <td>否</td> <td>否</td> <td>否</td> <td>事务 100% 隔离，可避免脏读、不可重复读、幻读的发生。花费最高代价但最可靠的事务隔离级别。</td></tr></tbody></table> <p><strong>查询级别</strong></p> <p>mysql8 版本查询隔离级别</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>select @@global.transaction_isolation,@@transaction_isolation;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>mysql8 以下版本查询隔离级别</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>select @@tx_isolation;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>设置级别</strong></p> <p>设置会话隔离级别，影响当前连接</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>set session transaction isolation level read uncommitted;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>设置全局隔离级别，影响全局连接</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>set global transaction isolation level read uncommitted;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>脏读</strong></p> <p>将隔离级别设置为最低级 <code>read uncommitted</code>。</p> <p>脏读是一个事务没有提交时可被其他事务读取到。</p> <p>事务B在事务A没有提交时就可以看到更新的数据，如果事务A执行<code>ROLLBACK</code> 事务B的读到的数据就为<strong>脏数据</strong>。</p> <p>将隔离级别设置为除 <code>read uncommitted</code>以外的，再重复上面的例子，都可以有效避免脏读的问题</p> <p><strong>不可重复读</strong></p> <p>不可重复读指在事务中多次读取的数据出现不一致的情况，我们希望读取的数据在本事务中是一致的。</p> <ul><li>事务A在执行过程中更新数据，事务B同时读取的数据没有脏数据。</li> <li>但当事务A提交了事务后，事务B再读取时得到了最新的数据，这种情况为不可重复读。</li> <li>所以要保证事务过程中的数据重复操作是一致的，不受其他事务影响，即避免不可重复读的产生。</li></ul> <p><strong>幻读</strong></p> <p>幻读和不可重复读都是读取了另一条已经提交的事务（这点就脏读不同），所不同的是不可重复读查询的都是同一个数据项，而幻读针对的是一批数据整体。</p> <p>事务A执行查询，假如查询结果是6条</p> <p>事务B执行添加新数据</p> <p>事务A执行更新，发现更新了7条（刚才查询时6条，但更新了七条，感觉像出现了幻觉）</p> <p>换隔离级别为 <strong>SERIALIZABLE</strong> 后，在事务A没有提交时，事务B是不能插入数据的（表现形式为等待）。</p> <h2 id="锁"><a href="#锁" class="header-anchor">#</a> 锁</h2> <ul><li>行锁开销大，锁表慢</li> <li>行锁高并发下可并行处理，性能更高</li> <li>行锁是针对索引加的锁，在通过索引检索时才会应用行锁，否则使用表锁</li> <li>在事务执行过程中，随时都可以执行锁定，锁在执行 COMMIT或者ROLLBACK的时候释放</li></ul> <p><strong>非索引阻塞</strong></p> <p>使用<strong>非索引字段筛选</strong>时，将造成全表锁定即表级锁</p> <p>事务A：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">BEGIN</span><span class="token punctuation">;</span>
<span class="token keyword">UPDATE</span> users <span class="token keyword">SET</span> uname <span class="token operator">=</span> <span class="token string">'First'</span> <span class="token keyword">WHERE</span> uname <span class="token operator">=</span><span class="token string">'更新'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>事务B：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">BEGIN</span><span class="token punctuation">;</span>
<span class="token keyword">update</span> users <span class="token keyword">set</span> uname<span class="token operator">=</span><span class="token string">&quot;yyy&quot;</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">4</span>
<span class="token comment"># 阻塞中---</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>范围锁</strong></p> <p>查询没有指定明确范围时也会造成大量记录的锁定</p> <p>事务B将不能修改表中的ID大于2的记录，但可以更改ID为1的记录</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">BEGIN</span><span class="token punctuation">;</span>
<span class="token keyword">UPDATE</span> users <span class="token keyword">SET</span> utext<span class="token operator">=</span><span class="token string">'123456'</span> <span class="token keyword">WHERE</span> id<span class="token operator">&gt;</span><span class="token number">1</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>悲观锁</strong></p> <p>非观锁指对数据被外界修改持保守态度，在整个数据处理过程中，将数据处于锁定状态，可以很好地解决并发事务的更新丢失问题。</p> <p><code>FOR UPDATE</code>，事务A执行悲观锁操作后，事务B就无法查询库存了</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">BEGIN</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> goods <span class="token keyword">WHERE</span> id<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">FOR</span> <span class="token keyword">UPDATE</span><span class="token punctuation">;</span>
<span class="token keyword">UPDATE</span> goods <span class="token keyword">SET</span> num<span class="token operator">=</span>num<span class="token operator">-</span><span class="token number">2</span> <span class="token keyword">WHERE</span> id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>乐观锁</strong></p> <p>在每次去拿数据的时候认为别人不会修改，不对数据上锁，但是在提交更新的时候会判断在此期间数据是否被更改，如果被更改则提交失败。</p> <p>通过设置<code>version</code>，事务A提交后<code>version</code>为1，那么事务B就更改不到数据了。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">BEGIN</span><span class="token punctuation">;</span>
<span class="token keyword">UPDATE</span> goods <span class="token keyword">SET</span> num<span class="token operator">=</span>num<span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span>VERSION <span class="token operator">=</span>VERSION<span class="token operator">+</span><span class="token number">1</span> <span class="token keyword">WHERE</span> VERSION<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>读锁</strong></p> <p>为表设置读锁后，当前会话和其他会话都不可以修改数据，但可以读取表数据。</p> <p><code>LOCK~READ</code>：读锁</p> <p><code>UNLOCK</code>：解除锁</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">LOCK</span> <span class="token keyword">TABLE</span> goods <span class="token keyword">READ</span><span class="token punctuation">;</span>
<span class="token keyword">UNLOCK</span> <span class="token keyword">TABLES</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>写锁</strong></p> <p>为表设置了写锁后，<strong>当前会话</strong>可以修改，查询表，其他会话将无法操作。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">LOCK</span> <span class="token keyword">TABLE</span> goods <span class="token keyword">WRITE</span><span class="token punctuation">;</span>
<span class="token keyword">UNLOCK</span> <span class="token keyword">TABLES</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="外键约束"><a href="#外键约束" class="header-anchor">#</a> 外键约束</h2> <p>父表的操作会影响到子表</p> <table><thead><tr><th>选项</th> <th>说明</th></tr></thead> <tbody><tr><td>CONSTRAINT</td> <td>为外键约束定义名称（唯一的）（子表名+父表名）</td></tr> <tr><td>FOREIGN KEY</td> <td>子表与父表关联的列</td></tr> <tr><td>REFERENCES</td> <td>子表关联的父表字段</td></tr> <tr><td>ON DELETE</td> <td>父表删除时的处理方式</td></tr> <tr><td>ON UPDATE</td> <td>父表更新时的处理方式</td></tr></tbody></table> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 学生表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> stu <span class="token punctuation">(</span>
  id <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
  sname <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  class_id <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">CONSTRAINT</span> stu_class
  <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>class_id<span class="token punctuation">)</span> 
  <span class="token keyword">REFERENCES</span> class <span class="token punctuation">(</span>id<span class="token punctuation">)</span> 
  <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">CASCADE</span> 
  <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CASCADE</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>给已存在的表添加外键约束</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> stu <span class="token keyword">ADD</span> 
<span class="token keyword">CONSTRAINT</span> stu_class
<span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>class_id<span class="token punctuation">)</span> 
<span class="token keyword">REFERENCES</span> class<span class="token punctuation">(</span>id<span class="token punctuation">)</span> 
<span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">SET</span> <span class="token boolean">NULL</span>
<span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CASCADE</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>删除</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> stu <span class="token keyword">DROP</span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> stu_class<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>ON DELETE</strong></p> <p>指在删除时的处理方式，常用的处理方式包括以下几种。</p> <table><thead><tr><th>选项</th> <th>说明</th></tr></thead> <tbody><tr><td>ON DELETE CASCADE</td> <td>删除父表记录时，子表记录同时删除</td></tr> <tr><td>ON DELETE SET NULL</td> <td>删除父表记录时，子表记录设置为NULL（子表字段要允许NULL）</td></tr> <tr><td>ON DELETE NO ACTION</td> <td>删除父表记录时，子表不做任何处理，必须把子表处理完才可以删除主表</td></tr></tbody></table> <p><strong>ON UPDATE</strong></p> <p>指在更新时的处理方式，常用的处理方式包括以下几种。</p> <table><thead><tr><th>选项</th> <th>说明</th></tr></thead> <tbody><tr><td>ON UPDATE CASCADE</td> <td>更新父表记录时，比如更改主表的主键时，子表记录同时更新</td></tr> <tr><td>ON UPDATE SET NULL</td> <td>更新父表记录时，比如更改主表的主键时，子表记录设置为NULL</td></tr> <tr><td>ON UPDATE NO ACTION</td> <td>更新父表记录时，子表不做任何处理，必须把子表处理完才可以更新主表</td></tr></tbody></table></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/pages/数据库/MongoDB.html" class="prev">
        MongoDB
      </a></span> <span class="next"><a href="/pages/用户配置/ESlint-Pretter.html">
        ESlint-Pretter
      </a>
      →
    </span></p></div> <hr> <div style="text-align:center;color:#767676;"><p>粤ICP备2021116118号</p></div></main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.4a585ce4.js" defer></script><script src="/assets/js/6.265514d3.js" defer></script><script src="/assets/js/2.1f413f74.js" defer></script><script src="/assets/js/24.c801625b.js" defer></script>
  </body>
</html>
