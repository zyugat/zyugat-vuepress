(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{406:function(s,a,t){"use strict";t.r(a);var e=t(31),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"docker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker"}},[s._v("#")]),s._v(" Docker")]),s._v(" "),t("blockquote",[t("p",[s._v("Linux中buff/caches占用过高")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将存于 buffer 中的资料强制写入硬盘中。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 表示清除pagecache （执行后问题得以解决）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /proc/sys/vm/drop_caches\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 表示清除回收slab分配器中的对象（包括目录项缓存和inode缓存）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# slab分配器是内核中管理内存的一种机制，其中很多缓存数据实现都是用的pagecache")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /proc/sys/vm/drop_caches\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 表示清除pagecache和slab分配器中的缓存对象 （这个可以的）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /proc/sys/vm/drop_caches\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])])]),s._v(" "),t("p",[s._v("沙箱：语言沙箱、系统沙箱")]),s._v(" "),t("p",[s._v("统一虚拟成不同的环境运行不同软件，虚拟机方案只能5-10个，但是Docker容器可以50-100个")]),s._v(" "),t("p",[s._v("虚拟机方案，每个方案都有一个独立的系统。")]),s._v(" "),t("p",[s._v("Docker容器，共用一个操作系统内核。")]),s._v(" "),t("p",[t("strong",[s._v("Docker 不是虚拟机，容器就是进程。")])]),s._v(" "),t("p",[t("strong",[s._v("安装")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" -y update\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" -y upgrade\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y apt-transport-https ca-certificates "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" software-properties-common gnupg2\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置阿里云gpg")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -fsSL https://mirrors.aliyun.com/docker-ce/linux/debian/gpg "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" apt-key "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" -\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果安装失败，那么就是开了代理，把代理关了")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# apt-get install -y software-properties-common")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 写入阿里云的源镜像")]),s._v("\nadd-apt-repository "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/debian '),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("lsb_release -cs"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(' stable"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 更新")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" -y update\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y docker-ce docker-ce-cli containerd.io\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启docker")]),s._v("\nsystemctl restart docker\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看版本")]),s._v("\ndocker --version\n\ndocker run hello-world\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br")])]),t("p",[s._v("镜像加速")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('vim /etc/docker/daemon.json\n\n{\n"registry-mirrors": [\n "https://mirror.ccs.tencentyun.com"\n]\n}\n\n{\n"registry-mirrors": ["https://2cbwkcky.mirror.ccs.aliyuncs.com"]\n}\n\nsystemctl daemon-reload\nsystemctl restart docker\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("blockquote",[t("p",[s._v("删除指令："),t("code",[s._v("-f")]),s._v(" 是强制删除，"),t("code",[s._v("-r")]),s._v(" 递归删除")])]),s._v(" "),t("h2",{attrs:{id:"镜像命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#镜像命令"}},[s._v("#")]),s._v(" 镜像命令")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看所有镜像")]),s._v("\ndocker images -a -q\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 选择")]),s._v("\n-a\t列出所有\n-q\t只显示id\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 搜索镜像")]),s._v("\ndocker search mysql\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 选项")]),s._v("\n--filter"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("STARS"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 搜索STARS大于3000的")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取镜像")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果不指定版本，默认获取最新的")]),s._v("\ndocker pull mysql:版本号\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除镜像")]),s._v("\ndocker rmi -f ID\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除所有镜像")]),s._v("\ndocker rmi -f "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("docker images -aq"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("p",[s._v("可以通过URL构建")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("docker build -t hello-world https://github.com/docker-library/hello-world.git\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("tar压缩包构建，自动下载解压")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("docker build http://server/context.tar.gz\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("标准输入")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("docker build - "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" Dockerfile\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" Dockerfile "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" docker build -\ndocker build - "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" context.tar.gz\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h2",{attrs:{id:"容器命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#容器命令"}},[s._v("#")]),s._v(" 容器命令")]),s._v(" "),t("p",[s._v("拉取镜像："),t("code",[s._v("docker pull centos")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 新建并启动")]),s._v("\ndocker run "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("可选参数"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" image\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 参数说明")]),s._v("\n--name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Name"')]),s._v("\t容器名字\n-d\t后台运行\n-it\t交互方式运行,进入容器查看内容\n-p\t指定端口\n\t-p 主机端口:容器端口\n\t-p 容器端口\n-P\t随机指定\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行并进入容器")]),s._v("\ndocker run -it centos /bin/bash\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 退出")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器不停止退出")]),s._v("\nCtrl + P + Q\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看正在运行的容器")]),s._v("\ndocker "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" \n-a\t当前运行+曾经运行过的容器\n-n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("?\t最近创建的容器\n-q\t只显示id\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除容器")]),s._v("\ndocker "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" ID\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除所有镜像")]),s._v("\ndocker "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -f "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("docker "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -aq"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器操作")]),s._v("\ndocker restart "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v("\ndocker "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v("\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 强制停止当前容器")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看日志,只看10条")]),s._v("\ndocker logs -tf --tail "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" ID\n--tail number\t查看number条日志\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看容器中进程信息")]),s._v("\ndocker "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" ID\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看元信息")]),s._v("\ndocker inspect ID\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入当前正在运行的容器,启动新的进程")]),s._v("\ndocker "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it ID /bin/bash\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入容器正在执行的终端，不会启动新的进程")]),s._v("\ndocker attach ID\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看容器资源占用")]),s._v("\ndocker stats ID\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br")])]),t("p",[s._v("导出容器："),t("code",[s._v("docker export ID > ubuntu.tar")])]),s._v(" "),t("p",[s._v("导入容器快照："),t("code",[s._v("cat ubuntu.tar | docker import - test/ubuntu:v1.0")])]),s._v(" "),t("p",[s._v("复制容器文件到主机："),t("code",[s._v("docker cp ID:容器文件路径 主机路径")])]),s._v(" "),t("p",[s._v("提交镜像："),t("code",[s._v('docker commit -m="描述信息" -a="作者" ID 目标镜像名:[TAG]')])]),s._v(" "),t("h2",{attrs:{id:"数据管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据管理"}},[s._v("#")]),s._v(" 数据管理")]),s._v(" "),t("p",[s._v("创建数据卷："),t("code",[s._v("docker volume create my-vol")])]),s._v(" "),t("p",[s._v("查看所有数据卷："),t("code",[s._v("docker volume ls")])]),s._v(" "),t("p",[s._v("查看指定数据卷："),t("code",[s._v("docker volume inspect my-vol")])]),s._v(" "),t("p",[s._v("查看web容器的信息："),t("code",[s._v("docker inspect web")])]),s._v(" "),t("p",[s._v("查看数据卷的信息："),t("code",[s._v("docker volume inspect 数据库名")])]),s._v(" "),t("p",[s._v("启动挂载数据卷：")]),s._v(" "),t("p",[s._v("通过："),t("code",[s._v("-v")]),s._v(" 挂载")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("-v 容器内路径      匿名挂载\n-v 卷名:容器内路径 具名挂载\n-v /主机路径:容器内路径\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 扩展，ro rw 改变读写权限")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 只读、可读可写")]),s._v("\ndocker run -it -v 主机地址:容器地址:ro /bin/bash\ndocker run -it -v 主机地址:容器地址:rw /bin/bash\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[t("code",[s._v("docker run -it -v 主机地址:容器地址 /bin/bash")])]),s._v(" "),t("p",[s._v("下面创建一个名为 "),t("code",[s._v("web")]),s._v(" 的容器，并加载一个 "),t("code",[s._v("数据卷")]),s._v(" 到容器的 "),t("code",[s._v("/usr/share/nginx/html")]),s._v(" 目录。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("$ docker run -d -P \\\n    --name web \\\n     -v my-vol:/usr/share/nginx/html \\\n    --mount source=my-vol,target=/usr/share/nginx/html \\\n    nginx:alpine\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[t("strong",[s._v("同步mysql数据")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("docker run -d -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3310")]),s._v(":3306 -e "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_ROOT_PASSWORD")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" --name mysql01 mysql:5.7 -v /home/mysql/conf:/etc/mysqk/conf.d -v /home/mysql/data:/var/lib/mysql\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("删除数据卷："),t("code",[s._v("docker volume rm my-vol")])]),s._v(" "),t("p",[s._v("如果需要在删除容器的同时移除数据卷。可以在删除容器的时候使用 "),t("code",[s._v("docker rm -v")]),s._v(" 这个命令。")]),s._v(" "),t("p",[s._v("无主的数据卷可能会占据很多空间，要清理请使用以下命令")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("docker volume prune\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("匿名挂载：")]),s._v(" "),t("p",[t("code",[s._v("-v /home/mysql/conf:/etc/mysqk/conf.d")])]),s._v(" "),t("p",[s._v("具名挂载：")]),s._v(" "),t("p",[t("code",[s._v("-v my-vol:/usr/share/nginx/html")])]),s._v(" "),t("p",[s._v("具名挂载数据路径："),t("code",[s._v("/var/lib/docker/volumes/卷名/_data")])]),s._v(" "),t("h2",{attrs:{id:"上下文context"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#上下文context"}},[s._v("#")]),s._v(" 上下文Context")]),s._v(" "),t("p",[s._v("在构建镜像的时候，"),t("code",[s._v("docker build")]),s._v(" 命令获取到用户指定构建镜像的"),t("strong",[s._v("上下文路径")]),s._v("，将内容打包上传给Docker引擎。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("COPY ./package.json /app/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("这并不是要复制执行 "),t("code",[s._v("docker build")]),s._v(" 命令所在的目录下的 "),t("code",[s._v("package.json")]),s._v("，也不是复制 "),t("code",[s._v("Dockerfile")]),s._v(" 所在目录下的 "),t("code",[s._v("package.json")]),s._v("，而是复制 "),t("strong",[s._v("上下文（context）")]),s._v(" 目录下的 "),t("code",[s._v("package.json")]),s._v("。")]),s._v(" "),t("p",[s._v("因此，"),t("code",[s._v("COPY")]),s._v(" 类指令的源文件路径都是相对路径。")]),s._v(" "),t("p",[t("code",[s._v("docker build -t nginx:v3 .")]),s._v(" 中的这个 "),t("code",[s._v(".")]),s._v("，实际上是在指定上下文的目录。")]),s._v(" "),t("p",[s._v("可以通过 "),t("code",[s._v("-f ../Dockerfile.php")]),s._v(" 参数指定某个文件作为 "),t("code",[s._v("Dockerfile")]),s._v("。")]),s._v(" "),t("h2",{attrs:{id:"dockerfile"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile"}},[s._v("#")]),s._v(" Dockerfile")]),s._v(" "),t("p",[s._v("创建Dockerfile文件")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" centos")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VOLUME")]),s._v(" ["),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/volume1"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/volume2"')]),s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" echo "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--end--"')])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" /bin/bash")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[t("strong",[s._v("创建镜像")])]),s._v(" "),t("p",[t("code",[s._v("-f")]),s._v("：文件路径")]),s._v(" "),t("p",[t("code",[s._v("-t")]),s._v("：镜像名与版本号")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("docker build -f dockerfile -t test/centos:1.0 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("运行：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("docker run -it --name 容器名字 镜像ID或"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("名字:版本"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("运行后，在主机可以通过："),t("code",[s._v("docker inspect ID")]),s._v(" 找到容器挂载两个卷的地址。")]),s._v(" "),t("p",[t("strong",[s._v("数据卷父子共享")])]),s._v(" "),t("p",[s._v("子容器挂载父容器的数据卷")]),s._v(" "),t("p",[t("code",[s._v("--volumes-from 父容器名字")])]),s._v(" "),t("hr"),s._v(" "),t("p",[s._v("常用命令")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v("\t\t\t\t# 基础镜像")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("MAINTAINER")]),s._v("\t# 指定维护者信息")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v("\t\t\t\t# 环境变量")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v("\t\t\t \t # 执行命令")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v("\t\t\t# 复制文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v("\t\t\t\t# 复制文件会自动解压，少用")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v("\t\t# 镜像工作目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VOLUME")]),s._v("\t\t# 挂载目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v("\t\t# 指定暴露端口")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v("\t\t\t\t# 容器启动后执行的命令,只有最后一个生效,会被替换")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" # 容器启动后执行的命令,追加命令")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ONBUILD")]),s._v("\t\t# 在当前镜像构建时并**不会被执行**。只有当以当前镜像为基础镜像，去构建下一级镜像的时候才会被执行。")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("p",[s._v("构建Tomat镜像")]),s._v(" "),t("p",[s._v("添加PATH路径通过 "),t("code",[s._v(":")]),s._v(" 隔开")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" centos")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("MAINTAINER")]),s._v(" bei<123@qq.com>")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" jdk路径 /usr/local/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" apache-tomcat路径 /usr/local/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" yum -y install vim")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" MYPATH /user/local")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$MYPATH")])]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" JAVA_HOME /docker_home/local/jdk的路径")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" JRE_HOME="),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$JAVA_HOME")]),s._v("/jre")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" CATALINA_HOME /docker_home/local/tomcat的路径")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" PATH "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PATH")]),s._v(":"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$JAVA_HOME")]),s._v("/bin:"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CATALINA_HOME")]),s._v("/bin")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 8080")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" tomact路径/bin/startup.sh")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("hr"),s._v(" "),t("h3",{attrs:{id:"from-指定镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#from-指定镜像"}},[s._v("#")]),s._v(" FROM 指定镜像")]),s._v(" "),t("p",[s._v("指定镜像，必须是第一条指令。")]),s._v(" "),t("h3",{attrs:{id:"run-执行命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#run-执行命令"}},[s._v("#")]),s._v(" RUN 执行命令")]),s._v(" "),t("p",[s._v("执行行命令，有两种格式")]),s._v(" "),t("p",[s._v("shell："),t("code",[s._v("RUN <命令>")])]),s._v(" "),t("p",[s._v("exec："),t("code",[s._v('RUN ["可执行文件", "参数N"]')])]),s._v(" "),t("p",[s._v("在需要套多层的时候，建议使用"),t("code",[s._v("&&")]),s._v("，不要一行一个RUN。**因为Dockerfile 中每一个指令都会建立一层，**Union FS 是有最大层数限制的，比如 AUFS，曾经是最大不得超过 42 层，现在是不得超过 127 层。")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 错误的")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt-get update")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt-get update")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 正确的")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt-get update"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n\t\t&& apt-get update")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h3",{attrs:{id:"copy-复制命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#copy-复制命令"}},[s._v("#")]),s._v(" COPY 复制命令")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" [--chown=<user>:<group>] <源路径>... <目标路径>")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" [--chown=<user>:<group>] ["),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<源路径1>"')]),s._v(",... "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<目标路径>"')]),s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("用于"),t("strong",[s._v("构建上下文目录")]),s._v("，源路径可以使用通配符，要要满足 Go 的 "),t("code",[s._v("filepath.Match")]),s._v("规则，目标路径是容器绝对路径")]),s._v(" "),t("p",[s._v("如果源路径为文件夹，复制的时候不是直接复制该文件夹，而是将文件夹中的内容复制到目标路径。")]),s._v(" "),t("h3",{attrs:{id:"add-高级的复制命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#add-高级的复制命令"}},[s._v("#")]),s._v(" ADD 高级的复制命令")]),s._v(" "),t("p",[s._v("与COPY差不多，能用COPY就用COPY，少用ADD。如果需要自动解压就用ADD，如果源路径是tar压缩格式gzip，bzip2，xz的话文件则会自动解压到目标路径上。")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" scratch")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" ubuntu-xenial-core-cloudimg-amd64-root.tar.gz /")]),s._v("\n...\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"cmd-容器启动命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cmd-容器启动命令"}},[s._v("#")]),s._v(" CMD 容器启动命令")]),s._v(" "),t("p",[s._v("和RUN差不多")]),s._v(" "),t("p",[s._v("shell："),t("code",[s._v("CMD <命令>")])]),s._v(" "),t("p",[s._v("exec："),t("code",[s._v('CMD ["可执行文件", "参数N"]')])]),s._v(" "),t("p",[s._v("Docker是容器，容器就是进程。启动容器时需要指定所运行程序及参数，"),t("code",[s._v("CMD")]),s._v("指令就是指定默认的容器主进程的启动命令。")]),s._v(" "),t("p",[s._v("容器只有前台没有后台，所有应用都应该在前台执行。")]),s._v(" "),t("p",[s._v("如果想启动NGINX写成这样："),t("code",[s._v("CMD service nginx start")])]),s._v(" "),t("p",[s._v("会发现容器执行后立刻退出，就算使用"),t("code",[s._v("systemctl")]),s._v("会发现无法使用，因为容器就是为了主进程而存在的，主进程退出，容器就失去了存在的意义，从而退出。")]),s._v(" "),t("p",[s._v("因此应该直接执行 "),t("code",[s._v("nginx")]),s._v(" 可执行文件，并且要求以前台形式运行。")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" ["),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-g"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"daemon off;"')]),s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"entrypoint-入口点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#entrypoint-入口点"}},[s._v("#")]),s._v(" ENTRYPOINT 入口点")]),s._v(" "),t("p",[s._v("格式和CMD一样，不同点在于当指定了 "),t("code",[s._v("ENTRYPOINT")]),s._v(" 后，"),t("code",[s._v("CMD")]),s._v(" 的含义就发生了改变，不再是直接的运行其命令，而是将 "),t("code",[s._v("CMD")]),s._v(" 的内容作为参数传给 "),t("code",[s._v("ENTRYPOINT")]),s._v(" 指令："),t("code",[s._v('<ENTRYPOINT> "<CMD>"')])]),s._v(" "),t("p",[t("strong",[s._v("1.让镜像变成像命令一样使用")])]),s._v(" "),t("p",[s._v("如果要获取IP地址：")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" [ "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"curl"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-s"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://myip.ipip.net"')]),s._v(" ]")]),s._v("\ndocker build -t myip .\n$ docker run myip\n当前 IP：61.148.226.66 来自：北京市 联通\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("如果想显示HTTP头信息就需要加上"),t("code",[s._v("-i")]),s._v("参数，但是跟在镜像名后面的是"),t("code",[s._v("command")]),s._v(" 会替换CMD默认值，"),t("code",[s._v("-i")]),s._v(" 根本不是命令。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ docker run myip -i\ndocker: Error response from daemon: invalid header field value "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"oci runtime error: container_linux.go:247: starting container process caused '),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("exec: "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("-i"),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v(": executable file not found in "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n$ docker run myip "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -s http://myip.ipip.net -i\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("因此需要用 "),t("code",[s._v("ENTRYPOINT")]),s._v(" 实现，将 "),t("code",[s._v("CMD")]),s._v(" 内容作为参数传给 "),t("code",[s._v("ENTRYPOINT")])]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" [ "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"curl"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-s"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://myip.ipip.net"')]),s._v(" ]")]),s._v("\ndocker run myip -i\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"env-环境变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#env-环境变量"}},[s._v("#")]),s._v(" ENV 环境变量")]),s._v(" "),t("p",[s._v("设置环境变量")]),s._v(" "),t("p",[t("code",[s._v("ENV <key> <value>")])]),s._v(" "),t("p",[t("code",[s._v("ENV <key1>=<value1> <key2>=<value2>...")])]),s._v(" "),t("p",[s._v("设置了环境变量"),t("code",[s._v("$NODE_VERSION")]),s._v("，作为版本号构建镜像。")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" NODE_VERSION 7.2.0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" curl -SLO "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://nodejs.org/dist/v$NODE_VERSION/node-v$NODE_VERSION-linux-x64.tar.xz"')])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"volume-定义匿名卷"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#volume-定义匿名卷"}},[s._v("#")]),s._v(" VOLUME 定义匿名卷")]),s._v(" "),t("p",[t("code",[s._v('VOLUME ["<路径1>", "<路径2>"...]')]),s._v(" "),t("code",[s._v("VOLUME <路径>")])]),s._v(" "),t("p",[t("code",[s._v("mydata")]),s._v(" 这个命名卷挂载到了 "),t("code",[s._v("/data")]),s._v(" 这个位置，替代了 "),t("code",[s._v("Dockerfile")]),s._v(" 中定义的匿名卷的挂载配置。")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VOLUME")]),s._v(" /data")]),s._v("\n$ docker run -d -v mydata:/data xxxx\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"expose-暴露端口"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#expose-暴露端口"}},[s._v("#")]),s._v(" EXPOSE 暴露端口")]),s._v(" "),t("p",[t("code",[s._v("EXPOSE <端口1> [<端口2>...]")])]),s._v(" "),t("p",[s._v("要将 "),t("code",[s._v("EXPOSE")]),s._v(" 和在运行时使用 "),t("code",[s._v("-p <宿主端口>:<容器端口>")]),s._v(" 区分开来。而 "),t("code",[s._v("EXPOSE")]),s._v(" 仅仅是声明容器打算使用什么端口而已，并不会自动在宿主进行端口映射。")]),s._v(" "),t("h3",{attrs:{id:"workdir-指定工作目录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#workdir-指定工作目录"}},[s._v("#")]),s._v(" WORKDIR 指定工作目录")]),s._v(" "),t("p",[t("code",[s._v("WORKDIR <工作目录路径>")])]),s._v(" "),t("p",[s._v("看看下面的错误示例，运行后是找不到"),t("code",[s._v("/app/world.txt")]),s._v("文件。因为在shell中是同一个进程执行环境，但是在"),t("code",[s._v("docker")]),s._v("中是两个不同的容器。")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" cd /app")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" echo "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello"')]),s._v(" > world.txt")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("因此如果想改变工作目录则需要，"),t("code",[s._v("RUN pwd")]),s._v(" 的工作目录为 "),t("code",[s._v("/a/b/c")]),s._v("。")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /a")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" b")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" c")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" pwd")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"user-指定当前用户"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#user-指定当前用户"}},[s._v("#")]),s._v(" USER 指定当前用户")]),s._v(" "),t("p",[t("code",[s._v("USER <用户名>[:<用户组>]")])]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 建立 redis 用户")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" groupadd -r redis && useradd -r -g redis redis")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"healthcheck-健康检查"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#healthcheck-健康检查"}},[s._v("#")]),s._v(" HEALTHCHECK 健康检查")]),s._v(" "),t("p",[t("code",[s._v("HEALTHCHECK [选项] CMD <命令>")]),s._v("：设置检查容器健康状况的命令")]),s._v(" "),t("p",[t("code",[s._v("HEALTHCHECK NONE")]),s._v("：如果基础镜像有健康检查指令，使用这行可以屏蔽掉其健康检查指令")]),s._v(" "),t("p",[s._v("支持下列选项：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("--interval=<间隔>")]),s._v("：两次健康检查的间隔，默认为 30 秒；")]),s._v(" "),t("li",[t("code",[s._v("--timeout=<时长>")]),s._v("：健康检查命令运行超时时间，如果超过这个时间，本次健康检查就被视为失败，默认 30 秒；")]),s._v(" "),t("li",[t("code",[s._v("--retries=<次数>")]),s._v("：当连续失败指定次数后，则将容器状态视为 "),t("code",[s._v("unhealthy")]),s._v("，默认 3 次。")])]),s._v(" "),t("p",[t("strong",[s._v("和 "),t("code",[s._v("CMD")]),s._v(", "),t("code",[s._v("ENTRYPOINT")]),s._v(" 一样，"),t("code",[s._v("HEALTHCHECK")]),s._v(" 只可以出现一次，如果写了多个，只有最后一个生效。")])]),s._v(" "),t("h3",{attrs:{id:"onbuild-为他人作嫁衣裳"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#onbuild-为他人作嫁衣裳"}},[s._v("#")]),s._v(" ONBUILD 为他人作嫁衣裳")]),s._v(" "),t("p",[s._v("格式："),t("code",[s._v("ONBUILD <其它指令>")]),s._v("。")]),s._v(" "),t("p",[s._v("在当前镜像构建时并"),t("strong",[s._v("不会被执行")]),s._v("。只有当以当前镜像为基础镜像，去构建下一级镜像的时候才会被执行。")]),s._v(" "),t("p",[s._v("流程是初始化环境，等其他项目的"),t("code",[s._v("Dockerfile")]),s._v("执行完在回来执行"),t("code",[s._v("ONBUILD")]),s._v("的指令运行项目。")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" node:slim")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" mkdir /app")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /app")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ONBUILD")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" ./package.json /app")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ONBUILD")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" [ "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"npm"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"install"')]),s._v(" ]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ONBUILD")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" . /app/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" [ "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"npm"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"start"')]),s._v(" ]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("各个项目的Dockerfile：")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" my-node")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"label-为镜像添加元数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#label-为镜像添加元数据"}},[s._v("#")]),s._v(" LABEL 为镜像添加元数据")]),s._v(" "),t("p",[t("code",[s._v("LABEL")]),s._v(" 指令用来给镜像以键值对的形式添加一些元数据（metadata）。")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LABEL")]),s._v(" <key>=<value> <key>=<value> <key>=<value> ...")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LABEL")]),s._v(" org.opencontainers.image.authors="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yeasy"')])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LABEL")]),s._v(" org.opencontainers.image.documentation="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://yeasy.gitbooks.io"')])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"shell-指令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#shell-指令"}},[s._v("#")]),s._v(" SHELL 指令")]),s._v(" "),t("p",[s._v("格式："),t("code",[s._v('SHELL ["executable", "parameters"]')])]),s._v(" "),t("h2",{attrs:{id:"docker-网络"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-网络"}},[s._v("#")]),s._v(" Docker 网络")]),s._v(" "),t("p",[s._v("启动一个容器，docker容器就会有一个IP地址，只要装了网卡就有docker0，桥接模式使用的技术是："),t("code",[s._v("evth-pair")])]),s._v(" "),t("p",[s._v("查看IP："),t("code",[s._v("ip addr")])]),s._v(" "),t("p",[t("code",[s._v("docker exec -it 容器名 ip addr")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("容器1：261:eth0@if262\n主机：262:veth@if261\n\n容器2：263:eth0@if264\n主机：264:veth@if263\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("容器1(261)连着Docker 0(262)")]),s._v(" "),t("p",[s._v("容器2(263)连着Docker 0(264)")]),s._v(" "),t("p",[s._v("Docker 0直连NAT到物理网卡就是主机的网卡。")]),s._v(" "),t("p",[s._v("可以得出结论，容器1与容器2不是直连的，都需要经过Docker 0路由（主机）。")]),s._v(" "),t("p",[t("strong",[s._v("Docker中的所有网络接口都是虚拟的，转发效率高。")])]),s._v(" "),t("p",[t("code",[s._v("--link")]),s._v("：在hosts中添加配置，不推荐使用")]),s._v(" "),t("p",[t("code",[s._v("docker network ls")]),s._v("：查看docker网络")]),s._v(" "),t("p",[s._v("网络模式：")]),s._v(" "),t("p",[s._v("none：不配置")]),s._v(" "),t("p",[s._v("bridge：桥接 docker ，默认")]),s._v(" "),t("p",[s._v("host：与主机共享网络")]),s._v(" "),t("p",[s._v("container：容器网络联通，用的少。")]),s._v(" "),t("p",[s._v("自定义网络：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("docker network create --driver bridge --subnet "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.0/16 --gateway "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.1 mynet\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通过--net指定网络")]),s._v("\ndocker run -d -P --name tomcat-net-01 --net mynet tomcat\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("网络连通")]),s._v(" "),t("p",[s._v("将 tomcat01 放在 mynet 网络下")]),s._v(" "),t("p",[t("code",[s._v("docker network connect mynet tomcat01")])]),s._v(" "),t("h2",{attrs:{id:"docker-compose"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose"}},[s._v("#")]),s._v(" Docker Compose")]),s._v(" "),t("p",[s._v("安装")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -L "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://github.com/docker/compose/releases/download/1.29.2/docker-compose-'),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" -s"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("-"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" -m"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v('"')]),s._v(" -o /usr/local/bin/docker-compose\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -L "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://get.daocloud.io/docker/compose/releases/download/1.29.2/docker-compose-'),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" -s"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("-"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" -m"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v('"')]),s._v(" -o /usr/local/bin/docker-compose\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x /usr/local/bin/docker-compose\n/usr/local/bin/docker-compose --version\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" composetest\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" composetest\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" requirements.txt\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# requirements.txt")]),s._v("\nflask\nredis\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("配置Compose")]),s._v(" "),t("p",[t("code",[s._v("docker-compose.yml")])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("web")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" .\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"5000:5000"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redis")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"redis:alpine"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[t("code",[s._v("docker network ls")])]),s._v(" "),t("p",[s._v("找到"),t("code",[s._v("composetest_default")])]),s._v(" "),t("p",[s._v("查看网络信息："),t("code",[s._v("docker network inspect NAME或ID")])]),s._v(" "),t("p",[s._v("运行："),t("code",[s._v("docker-compose up")])]),s._v(" "),t("p",[s._v("后台运行："),t("code",[s._v("docker-compose up -d")])]),s._v(" "),t("p",[s._v("yaml规则")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#版本")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("服务1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("服务2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dockerfile")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("configs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[t("strong",[s._v("部署wordpress")])]),s._v(" "),t("p",[t("code",[s._v("cd my_wordpress/")])]),s._v(" "),t("blockquote",[t("p",[s._v("image：镜像")]),s._v(" "),t("p",[s._v("volumes：数据卷")]),s._v(" "),t("p",[s._v("restart：是否重启，总是重启")]),s._v(" "),t("p",[s._v("environment：配置数据库（改root密码就行）")])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3.9"')]),s._v("\n    \n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("db")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.7")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" db_data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/var/lib/mysql\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" always\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("MYSQL_ROOT_PASSWORD")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" somewordpress\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("MYSQL_DATABASE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" wordpress\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("MYSQL_USER")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" wordpress\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("MYSQL_PASSWORD")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" wordpress\n    \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("wordpress")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("depends_on")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" db\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" wordpress"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" wordpress_data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/var/www/html\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8000:80"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" always\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("WORDPRESS_DB_HOST")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" db"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("WORDPRESS_DB_USER")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" wordpress\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("WORDPRESS_DB_PASSWORD")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" wordpress\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("WORDPRESS_DB_NAME")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" wordpress\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("db_data")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("wordpress_data")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br")])]),t("p",[s._v("运行："),t("code",[s._v("docker-compose up")])]),s._v(" "),t("p",[s._v("后台运行："),t("code",[s._v("docker-compose up -d")])]),s._v(" "),t("p",[s._v("如果有镜像（"),t("code",[s._v("image")]),s._v("）就是这么简单。如果没镜像就要自己写Dockerfile")]),s._v(" "),t("h2",{attrs:{id:"容器备份恢复"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#容器备份恢复"}},[s._v("#")]),s._v(" 容器备份恢复")]),s._v(" "),t("p",[t("code",[s._v("docker ps")])]),s._v(" "),t("p",[s._v("生成Docker镜像的容器快照：")]),s._v(" "),t("p",[t("code",[s._v("docker commit -p ID 备份容器名-backup")])]),s._v(" "),t("p",[s._v("通过"),t("code",[s._v("docker images")]),s._v("查看镜像")]),s._v(" "),t("p",[s._v("一个是我们可以登录进Docker注册中心，并推送该镜像到自己的Repositories中；另一种选择是是我们可以将Docker镜像打包成tar包备份到本地。")]),s._v(" "),t("p",[s._v("保存到本地：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v(" docker save -o ~/备份容器名-backup.tar 备份容器名-backup\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("code",[s._v("docker login")])]),s._v(" "),t("p",[s._v("上传之前，要先对镜像加tag：")]),s._v(" "),t("p",[t("code",[s._v("local-image")]),s._v("：本地镜像名")]),s._v(" "),t("p",[t("code",[s._v("new-repo")]),s._v("：仓库名")]),s._v(" "),t("p",[t("code",[s._v("tagname")]),s._v("：版本号（latest最新）")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("docker tag local-image new-repo:tagname\ndocker push new-repo:tagname\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("恢复镜像："),t("code",[s._v("docker pull 仓库名:tagname")])]),s._v(" "),t("p",[s._v("恢复本地："),t("code",[s._v("docker load -i ~/备份容器名-backup.tar")])]),s._v(" "),t("h2",{attrs:{id:"php构建加速"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#php构建加速"}},[s._v("#")]),s._v(" PHP构建加速")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" sed -i "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s@http://deb.debian.org@http://mirrors.aliyun.com@g"')]),s._v(" /etc/apt/sources.list && "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    apt-get clean")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# https://stephen520.cn/blog/10242")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# https://www.stephen520.cn/blog/10252")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" sed -i "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s@http://deb.debian.org@http://mirrors.aliyun.com@g"')]),s._v(" /etc/apt/sources.list && "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    rm -Rf /var/lib/apt/lists/* && "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    apt-get update && "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    apt-get install -y curl telnet git zlib1g-dev && "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    /bin/cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime && echo "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Asia/Shanghai'")]),s._v(" > /etc/timezone && "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    docker-php-ext-install zip pdo pdo_mysql opcache mysqli && "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    apt-get install -y nginx supervisor && "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    php -r "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"copy('https://getcomposer.org/installer', 'composer-setup.php');\"")]),s._v(" && "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    php composer-setup.php --install-dir=/usr/local/bin --filename=composer && "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    php -r "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"unlink('composer-setup.php');\"")]),s._v(" && "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    pecl install redis mongodb swoole && "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    rm -rf /tmp/pear && "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    docker-php-ext-enable redis mongodb swoole && "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    apt-get clean && rm -rf /var/cache/apt/*")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);