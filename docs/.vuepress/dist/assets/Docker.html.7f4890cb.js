import{c as n}from"./app.e1cbe8dc.js";import{_ as s}from"./plugin-vue_export-helper.21dcd24c.js";const a={},e=n(`<h1 id="docker" tabindex="-1"><a class="header-anchor" href="#docker" aria-hidden="true">#</a> Docker</h1><blockquote><p>Linux\u4E2Dbuff/caches\u5360\u7528\u8FC7\u9AD8</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u5C06\u5B58\u4E8E buffer \u4E2D\u7684\u8D44\u6599\u5F3A\u5236\u5199\u5165\u786C\u76D8\u4E2D\u3002</span>
<span class="token function">sync</span>
<span class="token comment"># \u8868\u793A\u6E05\u9664pagecache \uFF08\u6267\u884C\u540E\u95EE\u9898\u5F97\u4EE5\u89E3\u51B3\uFF09</span>
<span class="token builtin class-name">echo</span> <span class="token number">1</span> <span class="token operator">&gt;</span> /proc/sys/vm/drop_caches

<span class="token comment"># \u8868\u793A\u6E05\u9664\u56DE\u6536slab\u5206\u914D\u5668\u4E2D\u7684\u5BF9\u8C61\uFF08\u5305\u62EC\u76EE\u5F55\u9879\u7F13\u5B58\u548Cinode\u7F13\u5B58\uFF09</span>
<span class="token comment"># slab\u5206\u914D\u5668\u662F\u5185\u6838\u4E2D\u7BA1\u7406\u5185\u5B58\u7684\u4E00\u79CD\u673A\u5236\uFF0C\u5176\u4E2D\u5F88\u591A\u7F13\u5B58\u6570\u636E\u5B9E\u73B0\u90FD\u662F\u7528\u7684pagecache</span>
<span class="token builtin class-name">echo</span> <span class="token number">2</span> <span class="token operator">&gt;</span> /proc/sys/vm/drop_caches

<span class="token comment"># \u8868\u793A\u6E05\u9664pagecache\u548Cslab\u5206\u914D\u5668\u4E2D\u7684\u7F13\u5B58\u5BF9\u8C61 \uFF08\u8FD9\u4E2A\u53EF\u4EE5\u7684\uFF09</span>
<span class="token builtin class-name">echo</span> <span class="token number">3</span> <span class="token operator">&gt;</span> /proc/sys/vm/drop_caches
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></blockquote><p>\u6C99\u7BB1\uFF1A\u8BED\u8A00\u6C99\u7BB1\u3001\u7CFB\u7EDF\u6C99\u7BB1</p><p>\u7EDF\u4E00\u865A\u62DF\u6210\u4E0D\u540C\u7684\u73AF\u5883\u8FD0\u884C\u4E0D\u540C\u8F6F\u4EF6\uFF0C\u865A\u62DF\u673A\u65B9\u6848\u53EA\u80FD5-10\u4E2A\uFF0C\u4F46\u662FDocker\u5BB9\u5668\u53EF\u4EE550-100\u4E2A</p><p>\u865A\u62DF\u673A\u65B9\u6848\uFF0C\u6BCF\u4E2A\u65B9\u6848\u90FD\u6709\u4E00\u4E2A\u72EC\u7ACB\u7684\u7CFB\u7EDF\u3002</p><p>Docker\u5BB9\u5668\uFF0C\u5171\u7528\u4E00\u4E2A\u64CD\u4F5C\u7CFB\u7EDF\u5185\u6838\u3002</p><p><strong>Docker \u4E0D\u662F\u865A\u62DF\u673A\uFF0C\u5BB9\u5668\u5C31\u662F\u8FDB\u7A0B\u3002</strong></p><p><strong>\u5B89\u88C5</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">apt</span> -y update

<span class="token function">apt</span> -y upgrade

<span class="token function">apt</span> <span class="token function">install</span> -y apt-transport-https ca-certificates <span class="token function">curl</span> software-properties-common gnupg2

<span class="token comment"># \u914D\u7F6E\u963F\u91CC\u4E91gpg</span>
<span class="token function">curl</span> -fsSL https://mirrors.aliyun.com/docker-ce/linux/debian/gpg <span class="token operator">|</span> apt-key <span class="token function">add</span> -
<span class="token comment"># \u5982\u679C\u5B89\u88C5\u5931\u8D25\uFF0C\u90A3\u4E48\u5C31\u662F\u5F00\u4E86\u4EE3\u7406\uFF0C\u628A\u4EE3\u7406\u5173\u4E86</span>

<span class="token comment"># apt-get install -y software-properties-common</span>

<span class="token comment"># \u5199\u5165\u963F\u91CC\u4E91\u7684\u6E90\u955C\u50CF</span>
add-apt-repository <span class="token string">&quot;deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/debian <span class="token variable"><span class="token variable">$(</span>lsb_release -cs<span class="token variable">)</span></span> stable&quot;</span>

<span class="token comment"># \u66F4\u65B0</span>
<span class="token function">apt</span> -y update

<span class="token comment"># \u5B89\u88C5</span>
<span class="token function">apt</span> <span class="token function">install</span> -y docker-ce docker-ce-cli containerd.io

<span class="token comment"># \u91CD\u542Fdocker</span>
systemctl restart docker

<span class="token comment"># \u67E5\u770B\u7248\u672C</span>
docker --version

docker run hello-world
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>\u955C\u50CF\u52A0\u901F</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>vim /etc/docker/daemon.json

{
&quot;registry-mirrors&quot;: [
 &quot;https://mirror.ccs.tencentyun.com&quot;
]
}

{
&quot;registry-mirrors&quot;: [&quot;https://2cbwkcky.mirror.ccs.aliyuncs.com&quot;]
}

systemctl daemon-reload
systemctl restart docker
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><blockquote><p>\u5220\u9664\u6307\u4EE4\uFF1A<code>-f</code> \u662F\u5F3A\u5236\u5220\u9664\uFF0C<code>-r</code> \u9012\u5F52\u5220\u9664</p></blockquote><h2 id="\u955C\u50CF\u547D\u4EE4" tabindex="-1"><a class="header-anchor" href="#\u955C\u50CF\u547D\u4EE4" aria-hidden="true">#</a> \u955C\u50CF\u547D\u4EE4</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u67E5\u770B\u6240\u6709\u955C\u50CF</span>
docker images -a -q
<span class="token comment"># \u9009\u62E9</span>
-a	\u5217\u51FA\u6240\u6709
-q	\u53EA\u663E\u793Aid

<span class="token comment"># \u641C\u7D22\u955C\u50CF</span>
docker search mysql
<span class="token comment"># \u9009\u9879</span>
--filter<span class="token operator">=</span>STARS<span class="token operator">=</span><span class="token number">3000</span> <span class="token comment"># \u641C\u7D22STARS\u5927\u4E8E3000\u7684</span>

<span class="token comment"># \u83B7\u53D6\u955C\u50CF</span>
<span class="token comment"># \u5982\u679C\u4E0D\u6307\u5B9A\u7248\u672C\uFF0C\u9ED8\u8BA4\u83B7\u53D6\u6700\u65B0\u7684</span>
docker pull mysql:\u7248\u672C\u53F7

<span class="token comment"># \u5220\u9664\u955C\u50CF</span>
docker rmi -f ID
<span class="token comment"># \u5220\u9664\u6240\u6709\u955C\u50CF</span>
docker rmi -f <span class="token variable"><span class="token variable">$(</span>docker images -aq<span class="token variable">)</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>\u53EF\u4EE5\u901A\u8FC7URL\u6784\u5EFA</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker build -t hello-world https://github.com/docker-library/hello-world.git
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>tar\u538B\u7F29\u5305\u6784\u5EFA\uFF0C\u81EA\u52A8\u4E0B\u8F7D\u89E3\u538B</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker build http://server/context.tar.gz
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u6807\u51C6\u8F93\u5165</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker build - <span class="token operator">&lt;</span> Dockerfile
<span class="token function">cat</span> Dockerfile <span class="token operator">|</span> docker build -
docker build - <span class="token operator">&lt;</span> context.tar.gz
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="\u5BB9\u5668\u547D\u4EE4" tabindex="-1"><a class="header-anchor" href="#\u5BB9\u5668\u547D\u4EE4" aria-hidden="true">#</a> \u5BB9\u5668\u547D\u4EE4</h2><p>\u62C9\u53D6\u955C\u50CF\uFF1A<code>docker pull centos</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u65B0\u5EFA\u5E76\u542F\u52A8</span>
docker run <span class="token punctuation">[</span>\u53EF\u9009\u53C2\u6570<span class="token punctuation">]</span> image
<span class="token comment"># \u53C2\u6570\u8BF4\u660E</span>
--name<span class="token operator">=</span><span class="token string">&quot;Name&quot;</span>	\u5BB9\u5668\u540D\u5B57
-d	\u540E\u53F0\u8FD0\u884C
-it	\u4EA4\u4E92\u65B9\u5F0F\u8FD0\u884C,\u8FDB\u5165\u5BB9\u5668\u67E5\u770B\u5185\u5BB9
-p	\u6307\u5B9A\u7AEF\u53E3
	-p \u4E3B\u673A\u7AEF\u53E3:\u5BB9\u5668\u7AEF\u53E3
	-p \u5BB9\u5668\u7AEF\u53E3
-P	\u968F\u673A\u6307\u5B9A

<span class="token comment"># \u8FD0\u884C\u5E76\u8FDB\u5165\u5BB9\u5668</span>
docker run -it centos /bin/bash
<span class="token comment"># \u9000\u51FA</span>
<span class="token builtin class-name">exit</span>
<span class="token comment"># \u5BB9\u5668\u4E0D\u505C\u6B62\u9000\u51FA</span>
Ctrl + P + Q

<span class="token comment"># \u67E5\u770B\u6B63\u5728\u8FD0\u884C\u7684\u5BB9\u5668</span>
docker <span class="token function">ps</span> 
-a	\u5F53\u524D\u8FD0\u884C+\u66FE\u7ECF\u8FD0\u884C\u8FC7\u7684\u5BB9\u5668
-n<span class="token operator">=</span>?	\u6700\u8FD1\u521B\u5EFA\u7684\u5BB9\u5668
-q	\u53EA\u663E\u793Aid

<span class="token comment"># \u5220\u9664\u5BB9\u5668</span>
docker <span class="token function">rm</span> ID
<span class="token comment"># \u5220\u9664\u6240\u6709\u955C\u50CF</span>
docker <span class="token function">rm</span> -f <span class="token variable"><span class="token variable">$(</span>docker <span class="token function">ps</span> -aq<span class="token variable">)</span></span>

<span class="token comment"># \u5BB9\u5668\u64CD\u4F5C</span>
docker restart <span class="token function">id</span>
docker <span class="token function">kill</span> <span class="token function">id</span>	<span class="token comment"># \u5F3A\u5236\u505C\u6B62\u5F53\u524D\u5BB9\u5668</span>

<span class="token comment"># \u67E5\u770B\u65E5\u5FD7,\u53EA\u770B10\u6761</span>
docker logs -tf --tail <span class="token number">10</span> ID
--tail number	\u67E5\u770Bnumber\u6761\u65E5\u5FD7

<span class="token comment"># \u67E5\u770B\u5BB9\u5668\u4E2D\u8FDB\u7A0B\u4FE1\u606F</span>
docker <span class="token function">top</span> ID

<span class="token comment"># \u67E5\u770B\u5143\u4FE1\u606F</span>
docker inspect ID

<span class="token comment"># \u8FDB\u5165\u5F53\u524D\u6B63\u5728\u8FD0\u884C\u7684\u5BB9\u5668,\u542F\u52A8\u65B0\u7684\u8FDB\u7A0B</span>
docker <span class="token builtin class-name">exec</span> -it ID /bin/bash

<span class="token comment"># \u8FDB\u5165\u5BB9\u5668\u6B63\u5728\u6267\u884C\u7684\u7EC8\u7AEF\uFF0C\u4E0D\u4F1A\u542F\u52A8\u65B0\u7684\u8FDB\u7A0B</span>
docker attach ID

<span class="token comment"># \u67E5\u770B\u5BB9\u5668\u8D44\u6E90\u5360\u7528</span>
docker stats ID
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><p>\u5BFC\u51FA\u5BB9\u5668\uFF1A<code>docker export ID &gt; ubuntu.tar</code></p><p>\u5BFC\u5165\u5BB9\u5668\u5FEB\u7167\uFF1A<code>cat ubuntu.tar | docker import - test/ubuntu:v1.0</code></p><p>\u590D\u5236\u5BB9\u5668\u6587\u4EF6\u5230\u4E3B\u673A\uFF1A<code>docker cp ID:\u5BB9\u5668\u6587\u4EF6\u8DEF\u5F84 \u4E3B\u673A\u8DEF\u5F84</code></p><p>\u63D0\u4EA4\u955C\u50CF\uFF1A<code>docker commit -m=&quot;\u63CF\u8FF0\u4FE1\u606F&quot; -a=&quot;\u4F5C\u8005&quot; ID \u76EE\u6807\u955C\u50CF\u540D:[TAG]</code></p><h2 id="\u6570\u636E\u7BA1\u7406" tabindex="-1"><a class="header-anchor" href="#\u6570\u636E\u7BA1\u7406" aria-hidden="true">#</a> \u6570\u636E\u7BA1\u7406</h2><p>\u521B\u5EFA\u6570\u636E\u5377\uFF1A<code>docker volume create my-vol</code></p><p>\u67E5\u770B\u6240\u6709\u6570\u636E\u5377\uFF1A<code>docker volume ls</code></p><p>\u67E5\u770B\u6307\u5B9A\u6570\u636E\u5377\uFF1A<code>docker volume inspect my-vol</code></p><p>\u67E5\u770Bweb\u5BB9\u5668\u7684\u4FE1\u606F\uFF1A<code>docker inspect web</code></p><p>\u67E5\u770B\u6570\u636E\u5377\u7684\u4FE1\u606F\uFF1A<code>docker volume inspect \u6570\u636E\u5E93\u540D</code></p><p>\u542F\u52A8\u6302\u8F7D\u6570\u636E\u5377\uFF1A</p><p>\u901A\u8FC7\uFF1A<code>-v</code> \u6302\u8F7D</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>-v \u5BB9\u5668\u5185\u8DEF\u5F84      \u533F\u540D\u6302\u8F7D
-v \u5377\u540D:\u5BB9\u5668\u5185\u8DEF\u5F84 \u5177\u540D\u6302\u8F7D
-v /\u4E3B\u673A\u8DEF\u5F84:\u5BB9\u5668\u5185\u8DEF\u5F84

<span class="token comment"># \u6269\u5C55\uFF0Cro rw \u6539\u53D8\u8BFB\u5199\u6743\u9650</span>
<span class="token comment"># \u53EA\u8BFB\u3001\u53EF\u8BFB\u53EF\u5199</span>
docker run -it -v \u4E3B\u673A\u5730\u5740:\u5BB9\u5668\u5730\u5740:ro /bin/bash
docker run -it -v \u4E3B\u673A\u5730\u5740:\u5BB9\u5668\u5730\u5740:rw /bin/bash
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><code>docker run -it -v \u4E3B\u673A\u5730\u5740:\u5BB9\u5668\u5730\u5740 /bin/bash</code></p><p>\u4E0B\u9762\u521B\u5EFA\u4E00\u4E2A\u540D\u4E3A <code>web</code> \u7684\u5BB9\u5668\uFF0C\u5E76\u52A0\u8F7D\u4E00\u4E2A <code>\u6570\u636E\u5377</code> \u5230\u5BB9\u5668\u7684 <code>/usr/share/nginx/html</code> \u76EE\u5F55\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>$ docker run -d -P \\
    --name web \\
     -v my-vol:/usr/share/nginx/html \\
    --mount source=my-vol,target=/usr/share/nginx/html \\
    nginx:alpine
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>\u540C\u6B65mysql\u6570\u636E</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker run -d -p <span class="token number">3310</span>:3306 -e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">123456</span> --name mysql01 mysql:5.7 -v /home/mysql/conf:/etc/mysqk/conf.d -v /home/mysql/data:/var/lib/mysql
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u5220\u9664\u6570\u636E\u5377\uFF1A<code> docker volume rm my-vol</code></p><p>\u5982\u679C\u9700\u8981\u5728\u5220\u9664\u5BB9\u5668\u7684\u540C\u65F6\u79FB\u9664\u6570\u636E\u5377\u3002\u53EF\u4EE5\u5728\u5220\u9664\u5BB9\u5668\u7684\u65F6\u5019\u4F7F\u7528 <code>docker rm -v</code> \u8FD9\u4E2A\u547D\u4EE4\u3002</p><p>\u65E0\u4E3B\u7684\u6570\u636E\u5377\u53EF\u80FD\u4F1A\u5360\u636E\u5F88\u591A\u7A7A\u95F4\uFF0C\u8981\u6E05\u7406\u8BF7\u4F7F\u7528\u4EE5\u4E0B\u547D\u4EE4</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>docker volume prune
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u533F\u540D\u6302\u8F7D\uFF1A</p><p><code>-v /home/mysql/conf:/etc/mysqk/conf.d</code></p><p>\u5177\u540D\u6302\u8F7D\uFF1A</p><p><code>-v my-vol:/usr/share/nginx/html</code></p><p>\u5177\u540D\u6302\u8F7D\u6570\u636E\u8DEF\u5F84\uFF1A<code>/var/lib/docker/volumes/\u5377\u540D/_data</code></p><h2 id="\u4E0A\u4E0B\u6587context" tabindex="-1"><a class="header-anchor" href="#\u4E0A\u4E0B\u6587context" aria-hidden="true">#</a> \u4E0A\u4E0B\u6587Context</h2><p>\u5728\u6784\u5EFA\u955C\u50CF\u7684\u65F6\u5019\uFF0C<code>docker build</code> \u547D\u4EE4\u83B7\u53D6\u5230\u7528\u6237\u6307\u5B9A\u6784\u5EFA\u955C\u50CF\u7684<strong>\u4E0A\u4E0B\u6587\u8DEF\u5F84</strong>\uFF0C\u5C06\u5185\u5BB9\u6253\u5305\u4E0A\u4F20\u7ED9Docker\u5F15\u64CE\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>COPY ./package.json /app/
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u8FD9\u5E76\u4E0D\u662F\u8981\u590D\u5236\u6267\u884C <code>docker build</code> \u547D\u4EE4\u6240\u5728\u7684\u76EE\u5F55\u4E0B\u7684 <code>package.json</code>\uFF0C\u4E5F\u4E0D\u662F\u590D\u5236 <code>Dockerfile</code> \u6240\u5728\u76EE\u5F55\u4E0B\u7684 <code>package.json</code>\uFF0C\u800C\u662F\u590D\u5236 <strong>\u4E0A\u4E0B\u6587\uFF08context\uFF09</strong> \u76EE\u5F55\u4E0B\u7684 <code>package.json</code>\u3002</p><p>\u56E0\u6B64\uFF0C<code>COPY</code> \u7C7B\u6307\u4EE4\u7684\u6E90\u6587\u4EF6\u8DEF\u5F84\u90FD\u662F\u76F8\u5BF9\u8DEF\u5F84\u3002</p><p><code>docker build -t nginx:v3 .</code> \u4E2D\u7684\u8FD9\u4E2A <code>.</code>\uFF0C\u5B9E\u9645\u4E0A\u662F\u5728\u6307\u5B9A\u4E0A\u4E0B\u6587\u7684\u76EE\u5F55\u3002</p><p>\u53EF\u4EE5\u901A\u8FC7 <code>-f ../Dockerfile.php</code> \u53C2\u6570\u6307\u5B9A\u67D0\u4E2A\u6587\u4EF6\u4F5C\u4E3A <code>Dockerfile</code>\u3002</p><h2 id="dockerfile" tabindex="-1"><a class="header-anchor" href="#dockerfile" aria-hidden="true">#</a> Dockerfile</h2><p>\u521B\u5EFADockerfile\u6587\u4EF6</p><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">FROM</span> centos</span>
<span class="token instruction"><span class="token keyword">VOLUME</span> [<span class="token string">&quot;/volume1&quot;</span>, <span class="token string">&quot;/volume2&quot;</span>]</span>
<span class="token instruction"><span class="token keyword">CMD</span> echo <span class="token string">&quot;--end--&quot;</span></span>
<span class="token instruction"><span class="token keyword">CMD</span> /bin/bash</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>\u521B\u5EFA\u955C\u50CF</strong></p><p><code>-f</code>\uFF1A\u6587\u4EF6\u8DEF\u5F84</p><p><code>-t</code>\uFF1A\u955C\u50CF\u540D\u4E0E\u7248\u672C\u53F7</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker build -f dockerfile -t test/centos:1.0 <span class="token builtin class-name">.</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u8FD0\u884C\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker run -it --name \u5BB9\u5668\u540D\u5B57 \u955C\u50CFID\u6216<span class="token punctuation">(</span>\u540D\u5B57:\u7248\u672C<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u8FD0\u884C\u540E\uFF0C\u5728\u4E3B\u673A\u53EF\u4EE5\u901A\u8FC7\uFF1A<code>docker inspect ID</code> \u627E\u5230\u5BB9\u5668\u6302\u8F7D\u4E24\u4E2A\u5377\u7684\u5730\u5740\u3002</p><p><strong>\u6570\u636E\u5377\u7236\u5B50\u5171\u4EAB</strong></p><p>\u5B50\u5BB9\u5668\u6302\u8F7D\u7236\u5BB9\u5668\u7684\u6570\u636E\u5377</p><p><code>--volumes-from \u7236\u5BB9\u5668\u540D\u5B57</code></p><hr><p>\u5E38\u7528\u547D\u4EE4</p><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">FROM</span>				# \u57FA\u7840\u955C\u50CF</span>
<span class="token instruction"><span class="token keyword">MAINTAINER</span>	# \u6307\u5B9A\u7EF4\u62A4\u8005\u4FE1\u606F</span>
<span class="token instruction"><span class="token keyword">ENV</span>				# \u73AF\u5883\u53D8\u91CF</span>
<span class="token instruction"><span class="token keyword">RUN</span>			 	 # \u6267\u884C\u547D\u4EE4</span>

<span class="token instruction"><span class="token keyword">COPY</span>			# \u590D\u5236\u6587\u4EF6</span>
<span class="token instruction"><span class="token keyword">ADD</span>				# \u590D\u5236\u6587\u4EF6\u4F1A\u81EA\u52A8\u89E3\u538B\uFF0C\u5C11\u7528</span>

<span class="token instruction"><span class="token keyword">WORKDIR</span>		# \u955C\u50CF\u5DE5\u4F5C\u76EE\u5F55</span>
<span class="token instruction"><span class="token keyword">VOLUME</span>		# \u6302\u8F7D\u76EE\u5F55</span>
<span class="token instruction"><span class="token keyword">EXPOSE</span>		# \u6307\u5B9A\u66B4\u9732\u7AEF\u53E3</span>

<span class="token instruction"><span class="token keyword">CMD</span>				# \u5BB9\u5668\u542F\u52A8\u540E\u6267\u884C\u7684\u547D\u4EE4,\u53EA\u6709\u6700\u540E\u4E00\u4E2A\u751F\u6548,\u4F1A\u88AB\u66FF\u6362</span>
<span class="token instruction"><span class="token keyword">ENTRYPOINT</span> # \u5BB9\u5668\u542F\u52A8\u540E\u6267\u884C\u7684\u547D\u4EE4,\u8FFD\u52A0\u547D\u4EE4</span>
<span class="token instruction"><span class="token keyword">ONBUILD</span>		# \u5728\u5F53\u524D\u955C\u50CF\u6784\u5EFA\u65F6\u5E76**\u4E0D\u4F1A\u88AB\u6267\u884C**\u3002\u53EA\u6709\u5F53\u4EE5\u5F53\u524D\u955C\u50CF\u4E3A\u57FA\u7840\u955C\u50CF\uFF0C\u53BB\u6784\u5EFA\u4E0B\u4E00\u7EA7\u955C\u50CF\u7684\u65F6\u5019\u624D\u4F1A\u88AB\u6267\u884C\u3002</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>\u6784\u5EFATomat\u955C\u50CF</p><p>\u6DFB\u52A0PATH\u8DEF\u5F84\u901A\u8FC7 <code>:</code> \u9694\u5F00</p><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">FROM</span> centos</span>
<span class="token instruction"><span class="token keyword">MAINTAINER</span> bei&lt;123@qq.com&gt;</span>
<span class="token instruction"><span class="token keyword">ADD</span> jdk\u8DEF\u5F84 /usr/local/</span>
<span class="token instruction"><span class="token keyword">ADD</span> apache-tomcat\u8DEF\u5F84 /usr/local/</span>
<span class="token instruction"><span class="token keyword">RUN</span> yum -y install vim</span>

<span class="token instruction"><span class="token keyword">ENV</span> MYPATH /user/local</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> <span class="token variable">$MYPATH</span></span>

<span class="token instruction"><span class="token keyword">ENV</span> JAVA_HOME /docker_home/local/jdk\u7684\u8DEF\u5F84</span>
<span class="token instruction"><span class="token keyword">ENV</span> JRE_HOME=<span class="token variable">$JAVA_HOME</span>/jre</span>
<span class="token instruction"><span class="token keyword">ENV</span> CATALINA_HOME /docker_home/local/tomcat\u7684\u8DEF\u5F84</span>
<span class="token instruction"><span class="token keyword">ENV</span> PATH <span class="token variable">$PATH</span>:<span class="token variable">$JAVA_HOME</span>/bin:<span class="token variable">$CATALINA_HOME</span>/bin</span>

<span class="token instruction"><span class="token keyword">EXPOSE</span> 8080</span>
<span class="token instruction"><span class="token keyword">CMD</span> tomact\u8DEF\u5F84/bin/startup.sh</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><hr><h3 id="from-\u6307\u5B9A\u955C\u50CF" tabindex="-1"><a class="header-anchor" href="#from-\u6307\u5B9A\u955C\u50CF" aria-hidden="true">#</a> FROM \u6307\u5B9A\u955C\u50CF</h3><p>\u6307\u5B9A\u955C\u50CF\uFF0C\u5FC5\u987B\u662F\u7B2C\u4E00\u6761\u6307\u4EE4\u3002</p><h3 id="run-\u6267\u884C\u547D\u4EE4" tabindex="-1"><a class="header-anchor" href="#run-\u6267\u884C\u547D\u4EE4" aria-hidden="true">#</a> RUN \u6267\u884C\u547D\u4EE4</h3><p>\u6267\u884C\u884C\u547D\u4EE4\uFF0C\u6709\u4E24\u79CD\u683C\u5F0F</p><p>shell\uFF1A<code>RUN &lt;\u547D\u4EE4&gt;</code></p><p>exec\uFF1A<code>RUN [&quot;\u53EF\u6267\u884C\u6587\u4EF6&quot;, &quot;\u53C2\u6570N&quot;]</code></p><p>\u5728\u9700\u8981\u5957\u591A\u5C42\u7684\u65F6\u5019\uFF0C\u5EFA\u8BAE\u4F7F\u7528<code>&amp;&amp;</code>\uFF0C\u4E0D\u8981\u4E00\u884C\u4E00\u4E2ARUN\u3002**\u56E0\u4E3ADockerfile \u4E2D\u6BCF\u4E00\u4E2A\u6307\u4EE4\u90FD\u4F1A\u5EFA\u7ACB\u4E00\u5C42\uFF0C**Union FS \u662F\u6709\u6700\u5927\u5C42\u6570\u9650\u5236\u7684\uFF0C\u6BD4\u5982 AUFS\uFF0C\u66FE\u7ECF\u662F\u6700\u5927\u4E0D\u5F97\u8D85\u8FC7 42 \u5C42\uFF0C\u73B0\u5728\u662F\u4E0D\u5F97\u8D85\u8FC7 127 \u5C42\u3002</p><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token comment"># \u9519\u8BEF\u7684</span>
<span class="token instruction"><span class="token keyword">RUN</span> apt-get update</span>
<span class="token instruction"><span class="token keyword">RUN</span> apt-get update</span>
<span class="token comment"># \u6B63\u786E\u7684</span>
<span class="token instruction"><span class="token keyword">RUN</span> apt-get update<span class="token operator">\\</span>
		&amp;&amp; apt-get update</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="copy-\u590D\u5236\u547D\u4EE4" tabindex="-1"><a class="header-anchor" href="#copy-\u590D\u5236\u547D\u4EE4" aria-hidden="true">#</a> COPY \u590D\u5236\u547D\u4EE4</h3><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">COPY</span> [--chown=&lt;user&gt;:&lt;group&gt;] &lt;\u6E90\u8DEF\u5F84&gt;... &lt;\u76EE\u6807\u8DEF\u5F84&gt;</span>
<span class="token instruction"><span class="token keyword">COPY</span> [--chown=&lt;user&gt;:&lt;group&gt;] [<span class="token string">&quot;&lt;\u6E90\u8DEF\u5F841&gt;&quot;</span>,... <span class="token string">&quot;&lt;\u76EE\u6807\u8DEF\u5F84&gt;&quot;</span>]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u7528\u4E8E<strong>\u6784\u5EFA\u4E0A\u4E0B\u6587\u76EE\u5F55</strong>\uFF0C\u6E90\u8DEF\u5F84\u53EF\u4EE5\u4F7F\u7528\u901A\u914D\u7B26\uFF0C\u8981\u8981\u6EE1\u8DB3 Go \u7684 <code>filepath.Match</code>\u89C4\u5219\uFF0C\u76EE\u6807\u8DEF\u5F84\u662F\u5BB9\u5668\u7EDD\u5BF9\u8DEF\u5F84</p><p>\u5982\u679C\u6E90\u8DEF\u5F84\u4E3A\u6587\u4EF6\u5939\uFF0C\u590D\u5236\u7684\u65F6\u5019\u4E0D\u662F\u76F4\u63A5\u590D\u5236\u8BE5\u6587\u4EF6\u5939\uFF0C\u800C\u662F\u5C06\u6587\u4EF6\u5939\u4E2D\u7684\u5185\u5BB9\u590D\u5236\u5230\u76EE\u6807\u8DEF\u5F84\u3002</p><h3 id="add-\u9AD8\u7EA7\u7684\u590D\u5236\u547D\u4EE4" tabindex="-1"><a class="header-anchor" href="#add-\u9AD8\u7EA7\u7684\u590D\u5236\u547D\u4EE4" aria-hidden="true">#</a> ADD \u9AD8\u7EA7\u7684\u590D\u5236\u547D\u4EE4</h3><p>\u4E0ECOPY\u5DEE\u4E0D\u591A\uFF0C\u80FD\u7528COPY\u5C31\u7528COPY\uFF0C\u5C11\u7528ADD\u3002\u5982\u679C\u9700\u8981\u81EA\u52A8\u89E3\u538B\u5C31\u7528ADD\uFF0C\u5982\u679C\u6E90\u8DEF\u5F84\u662Ftar\u538B\u7F29\u683C\u5F0Fgzip\uFF0Cbzip2\uFF0Cxz\u7684\u8BDD\u6587\u4EF6\u5219\u4F1A\u81EA\u52A8\u89E3\u538B\u5230\u76EE\u6807\u8DEF\u5F84\u4E0A\u3002</p><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">FROM</span> scratch</span>
<span class="token instruction"><span class="token keyword">ADD</span> ubuntu-xenial-core-cloudimg-amd64-root.tar.gz /</span>
...
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="cmd-\u5BB9\u5668\u542F\u52A8\u547D\u4EE4" tabindex="-1"><a class="header-anchor" href="#cmd-\u5BB9\u5668\u542F\u52A8\u547D\u4EE4" aria-hidden="true">#</a> CMD \u5BB9\u5668\u542F\u52A8\u547D\u4EE4</h3><p>\u548CRUN\u5DEE\u4E0D\u591A</p><p>shell\uFF1A<code>CMD &lt;\u547D\u4EE4&gt;</code></p><p>exec\uFF1A<code>CMD [&quot;\u53EF\u6267\u884C\u6587\u4EF6&quot;, &quot;\u53C2\u6570N&quot;]</code></p><p>Docker\u662F\u5BB9\u5668\uFF0C\u5BB9\u5668\u5C31\u662F\u8FDB\u7A0B\u3002\u542F\u52A8\u5BB9\u5668\u65F6\u9700\u8981\u6307\u5B9A\u6240\u8FD0\u884C\u7A0B\u5E8F\u53CA\u53C2\u6570\uFF0C<code>CMD</code>\u6307\u4EE4\u5C31\u662F\u6307\u5B9A\u9ED8\u8BA4\u7684\u5BB9\u5668\u4E3B\u8FDB\u7A0B\u7684\u542F\u52A8\u547D\u4EE4\u3002</p><p>\u5BB9\u5668\u53EA\u6709\u524D\u53F0\u6CA1\u6709\u540E\u53F0\uFF0C\u6240\u6709\u5E94\u7528\u90FD\u5E94\u8BE5\u5728\u524D\u53F0\u6267\u884C\u3002</p><p>\u5982\u679C\u60F3\u542F\u52A8NGINX\u5199\u6210\u8FD9\u6837\uFF1A<code>CMD service nginx start</code></p><p>\u4F1A\u53D1\u73B0\u5BB9\u5668\u6267\u884C\u540E\u7ACB\u523B\u9000\u51FA\uFF0C\u5C31\u7B97\u4F7F\u7528<code>systemctl</code>\u4F1A\u53D1\u73B0\u65E0\u6CD5\u4F7F\u7528\uFF0C\u56E0\u4E3A\u5BB9\u5668\u5C31\u662F\u4E3A\u4E86\u4E3B\u8FDB\u7A0B\u800C\u5B58\u5728\u7684\uFF0C\u4E3B\u8FDB\u7A0B\u9000\u51FA\uFF0C\u5BB9\u5668\u5C31\u5931\u53BB\u4E86\u5B58\u5728\u7684\u610F\u4E49\uFF0C\u4ECE\u800C\u9000\u51FA\u3002</p><p>\u56E0\u6B64\u5E94\u8BE5\u76F4\u63A5\u6267\u884C <code>nginx</code> \u53EF\u6267\u884C\u6587\u4EF6\uFF0C\u5E76\u4E14\u8981\u6C42\u4EE5\u524D\u53F0\u5F62\u5F0F\u8FD0\u884C\u3002</p><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">CMD</span> [<span class="token string">&quot;nginx&quot;</span>, <span class="token string">&quot;-g&quot;</span>, <span class="token string">&quot;daemon off;&quot;</span>]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="entrypoint-\u5165\u53E3\u70B9" tabindex="-1"><a class="header-anchor" href="#entrypoint-\u5165\u53E3\u70B9" aria-hidden="true">#</a> ENTRYPOINT \u5165\u53E3\u70B9</h3><p>\u683C\u5F0F\u548CCMD\u4E00\u6837\uFF0C\u4E0D\u540C\u70B9\u5728\u4E8E\u5F53\u6307\u5B9A\u4E86 <code>ENTRYPOINT</code> \u540E\uFF0C<code>CMD</code> \u7684\u542B\u4E49\u5C31\u53D1\u751F\u4E86\u6539\u53D8\uFF0C\u4E0D\u518D\u662F\u76F4\u63A5\u7684\u8FD0\u884C\u5176\u547D\u4EE4\uFF0C\u800C\u662F\u5C06 <code>CMD</code> \u7684\u5185\u5BB9\u4F5C\u4E3A\u53C2\u6570\u4F20\u7ED9 <code>ENTRYPOINT</code> \u6307\u4EE4\uFF1A<code>&lt;ENTRYPOINT&gt; &quot;&lt;CMD&gt;&quot;</code></p><p><strong>1.\u8BA9\u955C\u50CF\u53D8\u6210\u50CF\u547D\u4EE4\u4E00\u6837\u4F7F\u7528</strong></p><p>\u5982\u679C\u8981\u83B7\u53D6IP\u5730\u5740\uFF1A</p><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">CMD</span> [ <span class="token string">&quot;curl&quot;</span>, <span class="token string">&quot;-s&quot;</span>, <span class="token string">&quot;http://myip.ipip.net&quot;</span> ]</span>
docker build -t myip .
$ docker run myip
\u5F53\u524D IP\uFF1A61.148.226.66 \u6765\u81EA\uFF1A\u5317\u4EAC\u5E02 \u8054\u901A
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u5982\u679C\u60F3\u663E\u793AHTTP\u5934\u4FE1\u606F\u5C31\u9700\u8981\u52A0\u4E0A<code>-i</code>\u53C2\u6570\uFF0C\u4F46\u662F\u8DDF\u5728\u955C\u50CF\u540D\u540E\u9762\u7684\u662F<code>command</code> \u4F1A\u66FF\u6362CMD\u9ED8\u8BA4\u503C\uFF0C<code>-i</code> \u6839\u672C\u4E0D\u662F\u547D\u4EE4\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ docker run myip -i
docker: Error response from daemon: invalid header field value <span class="token string">&quot;oci runtime error: container_linux.go:247: starting container process caused <span class="token entity" title="\\&quot;">\\&quot;</span>exec: <span class="token entity" title="\\\\">\\\\</span><span class="token entity" title="\\&quot;">\\&quot;</span>-i<span class="token entity" title="\\\\">\\\\</span><span class="token entity" title="\\&quot;">\\&quot;</span>: executable file not found in <span class="token environment constant">$PATH</span><span class="token entity" title="\\&quot;">\\&quot;</span><span class="token entity" title="\\n">\\n</span>&quot;</span><span class="token builtin class-name">.</span>
$ docker run myip <span class="token function">curl</span> -s http://myip.ipip.net -i
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u56E0\u6B64\u9700\u8981\u7528 <code>ENTRYPOINT</code> \u5B9E\u73B0\uFF0C\u5C06 <code>CMD</code> \u5185\u5BB9\u4F5C\u4E3A\u53C2\u6570\u4F20\u7ED9 <code>ENTRYPOINT</code></p><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">ENTRYPOINT</span> [ <span class="token string">&quot;curl&quot;</span>, <span class="token string">&quot;-s&quot;</span>, <span class="token string">&quot;http://myip.ipip.net&quot;</span> ]</span>
docker run myip -i
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="env-\u73AF\u5883\u53D8\u91CF" tabindex="-1"><a class="header-anchor" href="#env-\u73AF\u5883\u53D8\u91CF" aria-hidden="true">#</a> ENV \u73AF\u5883\u53D8\u91CF</h3><p>\u8BBE\u7F6E\u73AF\u5883\u53D8\u91CF</p><p><code>ENV &lt;key&gt; &lt;value&gt;</code></p><p><code>ENV &lt;key1&gt;=&lt;value1&gt; &lt;key2&gt;=&lt;value2&gt;...</code></p><p>\u8BBE\u7F6E\u4E86\u73AF\u5883\u53D8\u91CF<code>$NODE_VERSION</code>\uFF0C\u4F5C\u4E3A\u7248\u672C\u53F7\u6784\u5EFA\u955C\u50CF\u3002</p><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">ENV</span> NODE_VERSION 7.2.0</span>
<span class="token instruction"><span class="token keyword">RUN</span> curl -SLO <span class="token string">&quot;https://nodejs.org/dist/v$NODE_VERSION/node-v$NODE_VERSION-linux-x64.tar.xz&quot;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="volume-\u5B9A\u4E49\u533F\u540D\u5377" tabindex="-1"><a class="header-anchor" href="#volume-\u5B9A\u4E49\u533F\u540D\u5377" aria-hidden="true">#</a> VOLUME \u5B9A\u4E49\u533F\u540D\u5377</h3><p><code>VOLUME [&quot;&lt;\u8DEF\u5F841&gt;&quot;, &quot;&lt;\u8DEF\u5F842&gt;&quot;...]</code><code>VOLUME &lt;\u8DEF\u5F84&gt;</code></p><p><code>mydata</code> \u8FD9\u4E2A\u547D\u540D\u5377\u6302\u8F7D\u5230\u4E86 <code>/data</code> \u8FD9\u4E2A\u4F4D\u7F6E\uFF0C\u66FF\u4EE3\u4E86 <code>Dockerfile</code> \u4E2D\u5B9A\u4E49\u7684\u533F\u540D\u5377\u7684\u6302\u8F7D\u914D\u7F6E\u3002</p><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">VOLUME</span> /data</span>
$ docker run -d -v mydata:/data xxxx
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="expose-\u66B4\u9732\u7AEF\u53E3" tabindex="-1"><a class="header-anchor" href="#expose-\u66B4\u9732\u7AEF\u53E3" aria-hidden="true">#</a> EXPOSE \u66B4\u9732\u7AEF\u53E3</h3><p><code>EXPOSE &lt;\u7AEF\u53E31&gt; [&lt;\u7AEF\u53E32&gt;...]</code></p><p>\u8981\u5C06 <code>EXPOSE</code> \u548C\u5728\u8FD0\u884C\u65F6\u4F7F\u7528 <code>-p &lt;\u5BBF\u4E3B\u7AEF\u53E3&gt;:&lt;\u5BB9\u5668\u7AEF\u53E3&gt;</code> \u533A\u5206\u5F00\u6765\u3002\u800C <code>EXPOSE</code> \u4EC5\u4EC5\u662F\u58F0\u660E\u5BB9\u5668\u6253\u7B97\u4F7F\u7528\u4EC0\u4E48\u7AEF\u53E3\u800C\u5DF2\uFF0C\u5E76\u4E0D\u4F1A\u81EA\u52A8\u5728\u5BBF\u4E3B\u8FDB\u884C\u7AEF\u53E3\u6620\u5C04\u3002</p><h3 id="workdir-\u6307\u5B9A\u5DE5\u4F5C\u76EE\u5F55" tabindex="-1"><a class="header-anchor" href="#workdir-\u6307\u5B9A\u5DE5\u4F5C\u76EE\u5F55" aria-hidden="true">#</a> WORKDIR \u6307\u5B9A\u5DE5\u4F5C\u76EE\u5F55</h3><p><code>WORKDIR &lt;\u5DE5\u4F5C\u76EE\u5F55\u8DEF\u5F84&gt;</code></p><p>\u770B\u770B\u4E0B\u9762\u7684\u9519\u8BEF\u793A\u4F8B\uFF0C\u8FD0\u884C\u540E\u662F\u627E\u4E0D\u5230<code>/app/world.txt</code>\u6587\u4EF6\u3002\u56E0\u4E3A\u5728shell\u4E2D\u662F\u540C\u4E00\u4E2A\u8FDB\u7A0B\u6267\u884C\u73AF\u5883\uFF0C\u4F46\u662F\u5728<code>docker</code>\u4E2D\u662F\u4E24\u4E2A\u4E0D\u540C\u7684\u5BB9\u5668\u3002</p><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">RUN</span> cd /app</span>
<span class="token instruction"><span class="token keyword">RUN</span> echo <span class="token string">&quot;hello&quot;</span> &gt; world.txt</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u56E0\u6B64\u5982\u679C\u60F3\u6539\u53D8\u5DE5\u4F5C\u76EE\u5F55\u5219\u9700\u8981\uFF0C<code>RUN pwd</code> \u7684\u5DE5\u4F5C\u76EE\u5F55\u4E3A <code>/a/b/c</code>\u3002</p><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">WORKDIR</span> /a</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> b</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> c</span>

<span class="token instruction"><span class="token keyword">RUN</span> pwd</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="user-\u6307\u5B9A\u5F53\u524D\u7528\u6237" tabindex="-1"><a class="header-anchor" href="#user-\u6307\u5B9A\u5F53\u524D\u7528\u6237" aria-hidden="true">#</a> USER \u6307\u5B9A\u5F53\u524D\u7528\u6237</h3><p><code>USER &lt;\u7528\u6237\u540D&gt;[:&lt;\u7528\u6237\u7EC4&gt;]</code></p><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token comment"># \u5EFA\u7ACB redis \u7528\u6237</span>
<span class="token instruction"><span class="token keyword">RUN</span> groupadd -r redis &amp;&amp; useradd -r -g redis redis</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="healthcheck-\u5065\u5EB7\u68C0\u67E5" tabindex="-1"><a class="header-anchor" href="#healthcheck-\u5065\u5EB7\u68C0\u67E5" aria-hidden="true">#</a> HEALTHCHECK \u5065\u5EB7\u68C0\u67E5</h3><p><code>HEALTHCHECK [\u9009\u9879] CMD &lt;\u547D\u4EE4&gt;</code>\uFF1A\u8BBE\u7F6E\u68C0\u67E5\u5BB9\u5668\u5065\u5EB7\u72B6\u51B5\u7684\u547D\u4EE4</p><p><code>HEALTHCHECK NONE</code>\uFF1A\u5982\u679C\u57FA\u7840\u955C\u50CF\u6709\u5065\u5EB7\u68C0\u67E5\u6307\u4EE4\uFF0C\u4F7F\u7528\u8FD9\u884C\u53EF\u4EE5\u5C4F\u853D\u6389\u5176\u5065\u5EB7\u68C0\u67E5\u6307\u4EE4</p><p>\u652F\u6301\u4E0B\u5217\u9009\u9879\uFF1A</p><ul><li><code>--interval=&lt;\u95F4\u9694&gt;</code>\uFF1A\u4E24\u6B21\u5065\u5EB7\u68C0\u67E5\u7684\u95F4\u9694\uFF0C\u9ED8\u8BA4\u4E3A 30 \u79D2\uFF1B</li><li><code>--timeout=&lt;\u65F6\u957F&gt;</code>\uFF1A\u5065\u5EB7\u68C0\u67E5\u547D\u4EE4\u8FD0\u884C\u8D85\u65F6\u65F6\u95F4\uFF0C\u5982\u679C\u8D85\u8FC7\u8FD9\u4E2A\u65F6\u95F4\uFF0C\u672C\u6B21\u5065\u5EB7\u68C0\u67E5\u5C31\u88AB\u89C6\u4E3A\u5931\u8D25\uFF0C\u9ED8\u8BA4 30 \u79D2\uFF1B</li><li><code>--retries=&lt;\u6B21\u6570&gt;</code>\uFF1A\u5F53\u8FDE\u7EED\u5931\u8D25\u6307\u5B9A\u6B21\u6570\u540E\uFF0C\u5219\u5C06\u5BB9\u5668\u72B6\u6001\u89C6\u4E3A <code>unhealthy</code>\uFF0C\u9ED8\u8BA4 3 \u6B21\u3002</li></ul><p><strong>\u548C <code>CMD</code>, <code>ENTRYPOINT</code> \u4E00\u6837\uFF0C<code>HEALTHCHECK</code> \u53EA\u53EF\u4EE5\u51FA\u73B0\u4E00\u6B21\uFF0C\u5982\u679C\u5199\u4E86\u591A\u4E2A\uFF0C\u53EA\u6709\u6700\u540E\u4E00\u4E2A\u751F\u6548\u3002</strong></p><h3 id="onbuild-\u4E3A\u4ED6\u4EBA\u4F5C\u5AC1\u8863\u88F3" tabindex="-1"><a class="header-anchor" href="#onbuild-\u4E3A\u4ED6\u4EBA\u4F5C\u5AC1\u8863\u88F3" aria-hidden="true">#</a> ONBUILD \u4E3A\u4ED6\u4EBA\u4F5C\u5AC1\u8863\u88F3</h3><p>\u683C\u5F0F\uFF1A<code>ONBUILD &lt;\u5176\u5B83\u6307\u4EE4&gt;</code>\u3002</p><p>\u5728\u5F53\u524D\u955C\u50CF\u6784\u5EFA\u65F6\u5E76<strong>\u4E0D\u4F1A\u88AB\u6267\u884C</strong>\u3002\u53EA\u6709\u5F53\u4EE5\u5F53\u524D\u955C\u50CF\u4E3A\u57FA\u7840\u955C\u50CF\uFF0C\u53BB\u6784\u5EFA\u4E0B\u4E00\u7EA7\u955C\u50CF\u7684\u65F6\u5019\u624D\u4F1A\u88AB\u6267\u884C\u3002</p><p>\u6D41\u7A0B\u662F\u521D\u59CB\u5316\u73AF\u5883\uFF0C\u7B49\u5176\u4ED6\u9879\u76EE\u7684<code>Dockerfile</code>\u6267\u884C\u5B8C\u5728\u56DE\u6765\u6267\u884C<code>ONBUILD </code>\u7684\u6307\u4EE4\u8FD0\u884C\u9879\u76EE\u3002</p><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">FROM</span> node:slim</span>
<span class="token instruction"><span class="token keyword">RUN</span> mkdir /app</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> /app</span>
<span class="token instruction"><span class="token keyword">ONBUILD</span> <span class="token keyword">COPY</span> ./package.json /app</span>
<span class="token instruction"><span class="token keyword">ONBUILD</span> <span class="token keyword">RUN</span> [ <span class="token string">&quot;npm&quot;</span>, <span class="token string">&quot;install&quot;</span> ]</span>
<span class="token instruction"><span class="token keyword">ONBUILD</span> <span class="token keyword">COPY</span> . /app/</span>
<span class="token instruction"><span class="token keyword">CMD</span> [ <span class="token string">&quot;npm&quot;</span>, <span class="token string">&quot;start&quot;</span> ]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>\u5404\u4E2A\u9879\u76EE\u7684Dockerfile\uFF1A</p><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">FROM</span> my-node</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="label-\u4E3A\u955C\u50CF\u6DFB\u52A0\u5143\u6570\u636E" tabindex="-1"><a class="header-anchor" href="#label-\u4E3A\u955C\u50CF\u6DFB\u52A0\u5143\u6570\u636E" aria-hidden="true">#</a> LABEL \u4E3A\u955C\u50CF\u6DFB\u52A0\u5143\u6570\u636E</h3><p><code>LABEL</code> \u6307\u4EE4\u7528\u6765\u7ED9\u955C\u50CF\u4EE5\u952E\u503C\u5BF9\u7684\u5F62\u5F0F\u6DFB\u52A0\u4E00\u4E9B\u5143\u6570\u636E\uFF08metadata\uFF09\u3002</p><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">LABEL</span> &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; ...</span>

<span class="token instruction"><span class="token keyword">LABEL</span> org.opencontainers.image.authors=<span class="token string">&quot;yeasy&quot;</span></span>
<span class="token instruction"><span class="token keyword">LABEL</span> org.opencontainers.image.documentation=<span class="token string">&quot;https://yeasy.gitbooks.io&quot;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="shell-\u6307\u4EE4" tabindex="-1"><a class="header-anchor" href="#shell-\u6307\u4EE4" aria-hidden="true">#</a> SHELL \u6307\u4EE4</h3><p>\u683C\u5F0F\uFF1A<code>SHELL [&quot;executable&quot;, &quot;parameters&quot;]</code></p><h2 id="docker-\u7F51\u7EDC" tabindex="-1"><a class="header-anchor" href="#docker-\u7F51\u7EDC" aria-hidden="true">#</a> Docker \u7F51\u7EDC</h2><p>\u542F\u52A8\u4E00\u4E2A\u5BB9\u5668\uFF0Cdocker\u5BB9\u5668\u5C31\u4F1A\u6709\u4E00\u4E2AIP\u5730\u5740\uFF0C\u53EA\u8981\u88C5\u4E86\u7F51\u5361\u5C31\u6709docker0\uFF0C\u6865\u63A5\u6A21\u5F0F\u4F7F\u7528\u7684\u6280\u672F\u662F\uFF1A<code>evth-pair</code></p><p>\u67E5\u770BIP\uFF1A<code>ip addr</code></p><p><code>docker exec -it \u5BB9\u5668\u540D ip addr</code></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>\u5BB9\u56681\uFF1A261:eth0@if262
\u4E3B\u673A\uFF1A262:veth@if261

\u5BB9\u56682\uFF1A263:eth0@if264
\u4E3B\u673A\uFF1A264:veth@if263
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u5BB9\u56681(261)\u8FDE\u7740Docker 0(262)</p><p>\u5BB9\u56682(263)\u8FDE\u7740Docker 0(264)</p><p>Docker 0\u76F4\u8FDENAT\u5230\u7269\u7406\u7F51\u5361\u5C31\u662F\u4E3B\u673A\u7684\u7F51\u5361\u3002</p><p>\u53EF\u4EE5\u5F97\u51FA\u7ED3\u8BBA\uFF0C\u5BB9\u56681\u4E0E\u5BB9\u56682\u4E0D\u662F\u76F4\u8FDE\u7684\uFF0C\u90FD\u9700\u8981\u7ECF\u8FC7Docker 0\u8DEF\u7531\uFF08\u4E3B\u673A\uFF09\u3002</p><p><strong>Docker\u4E2D\u7684\u6240\u6709\u7F51\u7EDC\u63A5\u53E3\u90FD\u662F\u865A\u62DF\u7684\uFF0C\u8F6C\u53D1\u6548\u7387\u9AD8\u3002</strong></p><p><code>--link</code>\uFF1A\u5728hosts\u4E2D\u6DFB\u52A0\u914D\u7F6E\uFF0C\u4E0D\u63A8\u8350\u4F7F\u7528</p><p><code>docker network ls</code>\uFF1A\u67E5\u770Bdocker\u7F51\u7EDC</p><p>\u7F51\u7EDC\u6A21\u5F0F\uFF1A</p><p>none\uFF1A\u4E0D\u914D\u7F6E</p><p>bridge\uFF1A\u6865\u63A5 docker \uFF0C\u9ED8\u8BA4</p><p>host\uFF1A\u4E0E\u4E3B\u673A\u5171\u4EAB\u7F51\u7EDC</p><p>container\uFF1A\u5BB9\u5668\u7F51\u7EDC\u8054\u901A\uFF0C\u7528\u7684\u5C11\u3002</p><p>\u81EA\u5B9A\u4E49\u7F51\u7EDC\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker network create --driver bridge --subnet <span class="token number">192.168</span>.0.0/16 --gateway <span class="token number">192.168</span>.0.1 mynet

<span class="token comment"># \u901A\u8FC7--net\u6307\u5B9A\u7F51\u7EDC</span>
docker run -d -P --name tomcat-net-01 --net mynet tomcat
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u7F51\u7EDC\u8FDE\u901A</p><p>\u5C06 tomcat01 \u653E\u5728 mynet \u7F51\u7EDC\u4E0B</p><p><code>docker network connect mynet tomcat01</code></p><h2 id="docker-compose" tabindex="-1"><a class="header-anchor" href="#docker-compose" aria-hidden="true">#</a> Docker Compose</h2><p>\u5B89\u88C5</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">curl</span> -L <span class="token string">&quot;https://github.com/docker/compose/releases/download/1.29.2/docker-compose-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> -s<span class="token variable">)</span></span>-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> -m<span class="token variable">)</span></span>&quot;</span> -o /usr/local/bin/docker-compose

<span class="token function">curl</span> -L <span class="token string">&quot;https://get.daocloud.io/docker/compose/releases/download/1.29.2/docker-compose-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> -s<span class="token variable">)</span></span>-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> -m<span class="token variable">)</span></span>&quot;</span> -o /usr/local/bin/docker-compose

<span class="token function">chmod</span> +x /usr/local/bin/docker-compose
/usr/local/bin/docker-compose --version
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">mkdir</span> composetest
<span class="token builtin class-name">cd</span> composetest

<span class="token function">cat</span> requirements.txt
<span class="token comment"># requirements.txt</span>
flask
redis
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>\u914D\u7F6ECompose</p><p><code>docker-compose.yml</code></p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;1&quot;</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">web</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span> .
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;5000:5000&quot;</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">&quot;redis:alpine&quot;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><code>docker network ls</code></p><p>\u627E\u5230<code> composetest_default</code></p><p>\u67E5\u770B\u7F51\u7EDC\u4FE1\u606F\uFF1A<code>docker network inspect NAME\u6216ID</code></p><p>\u8FD0\u884C\uFF1A<code>docker-compose up</code></p><p>\u540E\u53F0\u8FD0\u884C\uFF1A<code>docker-compose up -d</code></p><p>yaml\u89C4\u5219</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span>	<span class="token comment">#\u7248\u672C</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>	<span class="token comment"># \u670D\u52A1</span>
	<span class="token key atrule">\u670D\u52A11</span><span class="token punctuation">:</span>
		<span class="token comment"># \u914D\u7F6E</span>
	<span class="token key atrule">\u670D\u52A12</span><span class="token punctuation">:</span>
		<span class="token key atrule">dockerfile</span><span class="token punctuation">:</span>
<span class="token key atrule">volumes</span><span class="token punctuation">:</span>
<span class="token key atrule">networks</span><span class="token punctuation">:</span>
<span class="token key atrule">configs</span><span class="token punctuation">:</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>\u90E8\u7F72wordpress</strong></p><p><code>cd my_wordpress/</code></p><blockquote><p>image\uFF1A\u955C\u50CF</p><p>volumes\uFF1A\u6570\u636E\u5377</p><p>restart\uFF1A\u662F\u5426\u91CD\u542F\uFF0C\u603B\u662F\u91CD\u542F</p><p>environment\uFF1A\u914D\u7F6E\u6570\u636E\u5E93\uFF08\u6539root\u5BC6\u7801\u5C31\u884C\uFF09</p></blockquote><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3.9&quot;</span>
    
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">db</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span><span class="token number">5.7</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> db_data<span class="token punctuation">:</span>/var/lib/mysql
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">MYSQL_ROOT_PASSWORD</span><span class="token punctuation">:</span> somewordpress
      <span class="token key atrule">MYSQL_DATABASE</span><span class="token punctuation">:</span> wordpress
      <span class="token key atrule">MYSQL_USER</span><span class="token punctuation">:</span> wordpress
      <span class="token key atrule">MYSQL_PASSWORD</span><span class="token punctuation">:</span> wordpress
    
  <span class="token key atrule">wordpress</span><span class="token punctuation">:</span>
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> db
    <span class="token key atrule">image</span><span class="token punctuation">:</span> wordpress<span class="token punctuation">:</span>latest
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> wordpress_data<span class="token punctuation">:</span>/var/www/html
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;8000:80&quot;</span>
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">WORDPRESS_DB_HOST</span><span class="token punctuation">:</span> db<span class="token punctuation">:</span><span class="token number">3306</span>
      <span class="token key atrule">WORDPRESS_DB_USER</span><span class="token punctuation">:</span> wordpress
      <span class="token key atrule">WORDPRESS_DB_PASSWORD</span><span class="token punctuation">:</span> wordpress
      <span class="token key atrule">WORDPRESS_DB_NAME</span><span class="token punctuation">:</span> wordpress
<span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  <span class="token key atrule">db_data</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token key atrule">wordpress_data</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>\u8FD0\u884C\uFF1A<code>docker-compose up</code></p><p>\u540E\u53F0\u8FD0\u884C\uFF1A<code>docker-compose up -d</code></p><p>\u5982\u679C\u6709\u955C\u50CF\uFF08<code>image</code>\uFF09\u5C31\u662F\u8FD9\u4E48\u7B80\u5355\u3002\u5982\u679C\u6CA1\u955C\u50CF\u5C31\u8981\u81EA\u5DF1\u5199Dockerfile</p><h2 id="\u5BB9\u5668\u5907\u4EFD\u6062\u590D" tabindex="-1"><a class="header-anchor" href="#\u5BB9\u5668\u5907\u4EFD\u6062\u590D" aria-hidden="true">#</a> \u5BB9\u5668\u5907\u4EFD\u6062\u590D</h2><p><code>docker ps</code></p><p>\u751F\u6210Docker\u955C\u50CF\u7684\u5BB9\u5668\u5FEB\u7167\uFF1A</p><p><code>docker commit -p ID \u5907\u4EFD\u5BB9\u5668\u540D-backup</code></p><p>\u901A\u8FC7<code>docker images</code>\u67E5\u770B\u955C\u50CF</p><p>\u4E00\u4E2A\u662F\u6211\u4EEC\u53EF\u4EE5\u767B\u5F55\u8FDBDocker\u6CE8\u518C\u4E2D\u5FC3\uFF0C\u5E76\u63A8\u9001\u8BE5\u955C\u50CF\u5230\u81EA\u5DF1\u7684Repositories\u4E2D\uFF1B\u53E6\u4E00\u79CD\u9009\u62E9\u662F\u662F\u6211\u4EEC\u53EF\u4EE5\u5C06Docker\u955C\u50CF\u6253\u5305\u6210tar\u5305\u5907\u4EFD\u5230\u672C\u5730\u3002</p><p>\u4FDD\u5B58\u5230\u672C\u5730\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code> docker save -o ~/\u5907\u4EFD\u5BB9\u5668\u540D-backup.tar \u5907\u4EFD\u5BB9\u5668\u540D-backup
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p><code>docker login</code></p><p>\u4E0A\u4F20\u4E4B\u524D\uFF0C\u8981\u5148\u5BF9\u955C\u50CF\u52A0tag\uFF1A</p><p><code>local-image</code>\uFF1A\u672C\u5730\u955C\u50CF\u540D</p><p><code>new-repo</code>\uFF1A\u4ED3\u5E93\u540D</p><p><code>tagname</code>\uFF1A\u7248\u672C\u53F7\uFF08latest\u6700\u65B0\uFF09</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker tag local-image new-repo:tagname
docker push new-repo:tagname
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u6062\u590D\u955C\u50CF\uFF1A<code>docker pull \u4ED3\u5E93\u540D:tagname</code></p><p>\u6062\u590D\u672C\u5730\uFF1A<code>docker load -i ~/\u5907\u4EFD\u5BB9\u5668\u540D-backup.tar</code></p><h2 id="php\u6784\u5EFA\u52A0\u901F" tabindex="-1"><a class="header-anchor" href="#php\u6784\u5EFA\u52A0\u901F" aria-hidden="true">#</a> PHP\u6784\u5EFA\u52A0\u901F</h2><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">RUN</span> sed -i <span class="token string">&quot;s@http://deb.debian.org@http://mirrors.aliyun.com@g&quot;</span> /etc/apt/sources.list &amp;&amp; <span class="token operator">\\</span>
    apt-get clean</span>


<span class="token comment"># https://stephen520.cn/blog/10242</span>
<span class="token comment"># https://www.stephen520.cn/blog/10252</span>
<span class="token instruction"><span class="token keyword">RUN</span> sed -i <span class="token string">&quot;s@http://deb.debian.org@http://mirrors.aliyun.com@g&quot;</span> /etc/apt/sources.list &amp;&amp; <span class="token operator">\\</span>
    rm -Rf /var/lib/apt/lists/* &amp;&amp; <span class="token operator">\\</span>
    apt-get update &amp;&amp; <span class="token operator">\\</span>
    apt-get install -y curl telnet git zlib1g-dev &amp;&amp; <span class="token operator">\\</span>
    /bin/cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp; echo <span class="token string">&#39;Asia/Shanghai&#39;</span> &gt; /etc/timezone &amp;&amp; <span class="token operator">\\</span>
    docker-php-ext-install zip pdo pdo_mysql opcache mysqli &amp;&amp; <span class="token operator">\\</span>
    apt-get install -y nginx supervisor &amp;&amp; <span class="token operator">\\</span>
    php -r <span class="token string">&quot;copy(&#39;https://getcomposer.org/installer&#39;, &#39;composer-setup.php&#39;);&quot;</span> &amp;&amp; <span class="token operator">\\</span>
    php composer-setup.php --install-dir=/usr/local/bin --filename=composer &amp;&amp; <span class="token operator">\\</span>
    php -r <span class="token string">&quot;unlink(&#39;composer-setup.php&#39;);&quot;</span> &amp;&amp; <span class="token operator">\\</span>
    pecl install redis mongodb swoole &amp;&amp; <span class="token operator">\\</span>
    rm -rf /tmp/pear &amp;&amp; <span class="token operator">\\</span>
    docker-php-ext-enable redis mongodb swoole &amp;&amp; <span class="token operator">\\</span>
    apt-get clean &amp;&amp; rm -rf /var/cache/apt/*</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div>`,212);function p(c,o){return e}var t=s(a,[["render",p]]);export{t as default};
